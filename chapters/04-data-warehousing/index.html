<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive data engineering course for software engineers transitioning to data roles"><meta name=author content="Data Engineering Bootcamp Team"><link href=https://yourusername.github.io/data-engineering-course/chapters/04-data-warehousing/ rel=canonical><link href=../03-database-modeling/quiz/ rel=prev><link href=quiz/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Content - Data Engineering Bootcamp</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#chapter-4-data-warehousing-bigquery class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Data Engineering Bootcamp" class="md-header__button md-logo" aria-label="Data Engineering Bootcamp" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Data Engineering Bootcamp </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Content </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/yourusername/data-engineering-course title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> data-engineering-course </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../course-description/ class=md-tabs__link> Course Description </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../01-python-sql-foundations/ class=md-tabs__link> Chapters </a> </li> <li class=md-tabs__item> <a href=../../sims/sql-execution-plan/spec/ class=md-tabs__link> Interactive MicroSims </a> </li> <li class=md-tabs__item> <a href=../../glossary/ class=md-tabs__link> Resources </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Data Engineering Bootcamp" class="md-nav__button md-logo" aria-label="Data Engineering Bootcamp" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Data Engineering Bootcamp </label> <div class=md-nav__source> <a href=https://github.com/yourusername/data-engineering-course title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> data-engineering-course </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../course-description/ class=md-nav__link> <span class=md-ellipsis> Course Description </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Chapters </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Chapters </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex> <span class=md-ellipsis> Chapter 1 - Python & SQL Foundations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Chapter 1 - Python & SQL Foundations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-python-sql-foundations/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> <li class=md-nav__item> <a href=../01-python-sql-foundations/quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Chapter 2 - Git & Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Chapter 2 - Git & Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../02-git-docker/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> <li class=md-nav__item> <a href=../02-git-docker/quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> Chapter 3 - Database Modeling </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Chapter 3 - Database Modeling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../03-database-modeling/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> <li class=md-nav__item> <a href=../03-database-modeling/quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4 checked> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> Chapter 4 - Data Warehousing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=true> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Chapter 4 - Data Warehousing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Content </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Content </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#learning-objectives class=md-nav__link> <span class=md-ellipsis> Learning Objectives </span> </a> </li> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#section-1-oltp-vs-olap-two-different-worlds class=md-nav__link> <span class=md-ellipsis> Section 1: OLTP vs OLAP - Two Different Worlds </span> </a> <nav class=md-nav aria-label="Section 1: OLTP vs OLAP - Two Different Worlds"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-the-same-question-two-systems class=md-nav__link> <span class=md-ellipsis> Example: The Same Question, Two Systems </span> </a> </li> <li class=md-nav__item> <a href=#key-differences class=md-nav__link> <span class=md-ellipsis> Key Differences </span> </a> </li> <li class=md-nav__item> <a href=#why-column-oriented-storage-matters class=md-nav__link> <span class=md-ellipsis> Why Column-Oriented Storage Matters </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-2-star-schema-the-foundation-of-data-warehousing class=md-nav__link> <span class=md-ellipsis> Section 2: Star Schema - The Foundation of Data Warehousing </span> </a> <nav class=md-nav aria-label="Section 2: Star Schema - The Foundation of Data Warehousing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea_1 class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-e-commerce-analytics-warehouse class=md-nav__link> <span class=md-ellipsis> Example: E-Commerce Analytics Warehouse </span> </a> </li> <li class=md-nav__item> <a href=#example-queries class=md-nav__link> <span class=md-ellipsis> Example Queries </span> </a> </li> <li class=md-nav__item> <a href=#design-principles class=md-nav__link> <span class=md-ellipsis> Design Principles </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters_1 class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it_1 class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-3-snowflake-schema-vs-star-schema class=md-nav__link> <span class=md-ellipsis> Section 3: Snowflake Schema vs. Star Schema </span> </a> <nav class=md-nav aria-label="Section 3: Snowflake Schema vs. Star Schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea_2 class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-product-dimension-normalization class=md-nav__link> <span class=md-ellipsis> Example: Product Dimension Normalization </span> </a> </li> <li class=md-nav__item> <a href=#query-comparison class=md-nav__link> <span class=md-ellipsis> Query Comparison </span> </a> </li> <li class=md-nav__item> <a href=#trade-offs class=md-nav__link> <span class=md-ellipsis> Trade-offs </span> </a> </li> <li class=md-nav__item> <a href=#when-to-use-snowflake-schema class=md-nav__link> <span class=md-ellipsis> When to Use Snowflake Schema </span> </a> </li> <li class=md-nav__item> <a href=#hybrid-approach class=md-nav__link> <span class=md-ellipsis> Hybrid Approach </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters_2 class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it_2 class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-4-bigquery-optimization-partitioning-and-clustering class=md-nav__link> <span class=md-ellipsis> Section 4: BigQuery Optimization - Partitioning and Clustering </span> </a> <nav class=md-nav aria-label="Section 4: BigQuery Optimization - Partitioning and Clustering"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea_3 class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-the-cost-problem class=md-nav__link> <span class=md-ellipsis> Example: The Cost Problem </span> </a> </li> <li class=md-nav__item> <a href=#partitioning-strategies class=md-nav__link> <span class=md-ellipsis> Partitioning Strategies </span> </a> </li> <li class=md-nav__item> <a href=#clustering-optimizing-within-partitions class=md-nav__link> <span class=md-ellipsis> Clustering: Optimizing Within Partitions </span> </a> </li> <li class=md-nav__item> <a href=#clustering-best-practices class=md-nav__link> <span class=md-ellipsis> Clustering Best Practices </span> </a> </li> <li class=md-nav__item> <a href=#cost-analysis-example class=md-nav__link> <span class=md-ellipsis> Cost Analysis Example </span> </a> </li> <li class=md-nav__item> <a href=#partition-expiration class=md-nav__link> <span class=md-ellipsis> Partition Expiration </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters_3 class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it_3 class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-5-slowly-changing-dimensions-scd-type-2 class=md-nav__link> <span class=md-ellipsis> Section 5: Slowly Changing Dimensions (SCD) Type 2 </span> </a> <nav class=md-nav aria-label="Section 5: Slowly Changing Dimensions (SCD) Type 2"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea_4 class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-customer-address-changes class=md-nav__link> <span class=md-ellipsis> Example: Customer Address Changes </span> </a> </li> <li class=md-nav__item> <a href=#implementing-scd-type-2 class=md-nav__link> <span class=md-ellipsis> Implementing SCD Type 2 </span> </a> </li> <li class=md-nav__item> <a href=#querying-scd-type-2-tables class=md-nav__link> <span class=md-ellipsis> Querying SCD Type 2 Tables </span> </a> </li> <li class=md-nav__item> <a href=#which-attributes-should-be-scd-type-2 class=md-nav__link> <span class=md-ellipsis> Which Attributes Should Be SCD Type 2? </span> </a> </li> <li class=md-nav__item> <a href=#etl-pipeline-for-scd-type-2 class=md-nav__link> <span class=md-ellipsis> ETL Pipeline for SCD Type 2 </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters_4 class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it_4 class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common-pitfalls class=md-nav__link> <span class=md-ellipsis> Common Pitfalls </span> </a> <nav class=md-nav aria-label="Common Pitfalls"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-querying-fact-with-natural-key-instead-of-surrogate-key class=md-nav__link> <span class=md-ellipsis> 1. Querying Fact with Natural Key Instead of Surrogate Key </span> </a> </li> <li class=md-nav__item> <a href=#2-not-choosing-partition-key-based-on-query-patterns class=md-nav__link> <span class=md-ellipsis> 2. Not Choosing Partition Key Based on Query Patterns </span> </a> </li> <li class=md-nav__item> <a href=#3-over-clustering class=md-nav__link> <span class=md-ellipsis> 3. Over-Clustering </span> </a> </li> <li class=md-nav__item> <a href=#4-not-handling-dimension-load-order class=md-nav__link> <span class=md-ellipsis> 4. Not Handling Dimension Load Order </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reflection-questions class=md-nav__link> <span class=md-ellipsis> Reflection Questions </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> Chapter 5 - ETL/ELT & Apache Airflow </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Chapter 5 - ETL/ELT & Apache Airflow </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../05-etl-airflow/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> <li class=md-nav__item> <a href=../05-etl-airflow/quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> Chapter 6 - Data Quality & Error Handling </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Chapter 6 - Data Quality & Error Handling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../06-data-quality/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex> <span class=md-ellipsis> Chapter 7 - Apache Spark & PySpark </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Chapter 7 - Apache Spark & PySpark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../07-spark-pyspark/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex> <span class=md-ellipsis> Chapter 8 - Kafka & Streaming Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Chapter 8 - Kafka & Streaming Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../08-kafka-streaming/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex> <span class=md-ellipsis> Chapter 9 - Cloud Data Engineering (GCP) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Chapter 9 - Cloud Data Engineering (GCP) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../09-cloud-gcp/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_10> <label class=md-nav__link for=__nav_3_10 id=__nav_3_10_label tabindex> <span class=md-ellipsis> Chapter 10 - Infrastructure as Code & CI/CD </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=false> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Chapter 10 - Infrastructure as Code & CI/CD </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../10-iac-cicd/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_11> <label class=md-nav__link for=__nav_3_11 id=__nav_3_11_label tabindex> <span class=md-ellipsis> Chapter 11 - Capstone Project (Design) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_11_label aria-expanded=false> <label class=md-nav__title for=__nav_3_11> <span class="md-nav__icon md-icon"></span> Chapter 11 - Capstone Project (Design) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../11-capstone-part1/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_12> <label class=md-nav__link for=__nav_3_12 id=__nav_3_12_label tabindex> <span class=md-ellipsis> Chapter 12 - Capstone Project (Implementation) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_12_label aria-expanded=false> <label class=md-nav__title for=__nav_3_12> <span class="md-nav__icon md-icon"></span> Chapter 12 - Capstone Project (Implementation) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../12-capstone-part2/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Interactive MicroSims </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Interactive MicroSims </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sims/sql-execution-plan/spec/ class=md-nav__link> <span class=md-ellipsis> SQL Execution Plan Visualizer </span> </a> </li> <li class=md-nav__item> <a href=../../sims/git-merge-rebase/spec/ class=md-nav__link> <span class=md-ellipsis> Git Merge vs Rebase </span> </a> </li> <li class=md-nav__item> <a href=../../sims/star-vs-snowflake/spec/ class=md-nav__link> <span class=md-ellipsis> Star vs Snowflake Schema </span> </a> </li> <li class=md-nav__item> <a href=../../sims/normalization-journey/spec/ class=md-nav__link> <span class=md-ellipsis> Database Normalization </span> </a> </li> <li class=md-nav__item> <a href=../../sims/bigquery-partitioning/spec/ class=md-nav__link> <span class=md-ellipsis> BigQuery Partitioning </span> </a> </li> <li class=md-nav__item> <a href=../../sims/scd-timeline/spec/ class=md-nav__link> <span class=md-ellipsis> Slowly Changing Dimensions </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Resources </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../glossary/ class=md-nav__link> <span class=md-ellipsis> Glossary </span> </a> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../learning-graph/learning-graph.json class=md-nav__link> <span class=md-ellipsis> Learning Graph </span> </a> </li> <li class=md-nav__item> <a href=../INDEX/ class=md-nav__link> <span class=md-ellipsis> Quiz Guide </span> </a> </li> <li class=md-nav__item> <a href=../INSTRUCTOR_GUIDE/ class=md-nav__link> <span class=md-ellipsis> Instructor Guide </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#learning-objectives class=md-nav__link> <span class=md-ellipsis> Learning Objectives </span> </a> </li> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#section-1-oltp-vs-olap-two-different-worlds class=md-nav__link> <span class=md-ellipsis> Section 1: OLTP vs OLAP - Two Different Worlds </span> </a> <nav class=md-nav aria-label="Section 1: OLTP vs OLAP - Two Different Worlds"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-the-same-question-two-systems class=md-nav__link> <span class=md-ellipsis> Example: The Same Question, Two Systems </span> </a> </li> <li class=md-nav__item> <a href=#key-differences class=md-nav__link> <span class=md-ellipsis> Key Differences </span> </a> </li> <li class=md-nav__item> <a href=#why-column-oriented-storage-matters class=md-nav__link> <span class=md-ellipsis> Why Column-Oriented Storage Matters </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-2-star-schema-the-foundation-of-data-warehousing class=md-nav__link> <span class=md-ellipsis> Section 2: Star Schema - The Foundation of Data Warehousing </span> </a> <nav class=md-nav aria-label="Section 2: Star Schema - The Foundation of Data Warehousing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea_1 class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-e-commerce-analytics-warehouse class=md-nav__link> <span class=md-ellipsis> Example: E-Commerce Analytics Warehouse </span> </a> </li> <li class=md-nav__item> <a href=#example-queries class=md-nav__link> <span class=md-ellipsis> Example Queries </span> </a> </li> <li class=md-nav__item> <a href=#design-principles class=md-nav__link> <span class=md-ellipsis> Design Principles </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters_1 class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it_1 class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-3-snowflake-schema-vs-star-schema class=md-nav__link> <span class=md-ellipsis> Section 3: Snowflake Schema vs. Star Schema </span> </a> <nav class=md-nav aria-label="Section 3: Snowflake Schema vs. Star Schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea_2 class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-product-dimension-normalization class=md-nav__link> <span class=md-ellipsis> Example: Product Dimension Normalization </span> </a> </li> <li class=md-nav__item> <a href=#query-comparison class=md-nav__link> <span class=md-ellipsis> Query Comparison </span> </a> </li> <li class=md-nav__item> <a href=#trade-offs class=md-nav__link> <span class=md-ellipsis> Trade-offs </span> </a> </li> <li class=md-nav__item> <a href=#when-to-use-snowflake-schema class=md-nav__link> <span class=md-ellipsis> When to Use Snowflake Schema </span> </a> </li> <li class=md-nav__item> <a href=#hybrid-approach class=md-nav__link> <span class=md-ellipsis> Hybrid Approach </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters_2 class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it_2 class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-4-bigquery-optimization-partitioning-and-clustering class=md-nav__link> <span class=md-ellipsis> Section 4: BigQuery Optimization - Partitioning and Clustering </span> </a> <nav class=md-nav aria-label="Section 4: BigQuery Optimization - Partitioning and Clustering"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea_3 class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-the-cost-problem class=md-nav__link> <span class=md-ellipsis> Example: The Cost Problem </span> </a> </li> <li class=md-nav__item> <a href=#partitioning-strategies class=md-nav__link> <span class=md-ellipsis> Partitioning Strategies </span> </a> </li> <li class=md-nav__item> <a href=#clustering-optimizing-within-partitions class=md-nav__link> <span class=md-ellipsis> Clustering: Optimizing Within Partitions </span> </a> </li> <li class=md-nav__item> <a href=#clustering-best-practices class=md-nav__link> <span class=md-ellipsis> Clustering Best Practices </span> </a> </li> <li class=md-nav__item> <a href=#cost-analysis-example class=md-nav__link> <span class=md-ellipsis> Cost Analysis Example </span> </a> </li> <li class=md-nav__item> <a href=#partition-expiration class=md-nav__link> <span class=md-ellipsis> Partition Expiration </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters_3 class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it_3 class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-5-slowly-changing-dimensions-scd-type-2 class=md-nav__link> <span class=md-ellipsis> Section 5: Slowly Changing Dimensions (SCD) Type 2 </span> </a> <nav class=md-nav aria-label="Section 5: Slowly Changing Dimensions (SCD) Type 2"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#key-idea_4 class=md-nav__link> <span class=md-ellipsis> Key Idea </span> </a> </li> <li class=md-nav__item> <a href=#example-customer-address-changes class=md-nav__link> <span class=md-ellipsis> Example: Customer Address Changes </span> </a> </li> <li class=md-nav__item> <a href=#implementing-scd-type-2 class=md-nav__link> <span class=md-ellipsis> Implementing SCD Type 2 </span> </a> </li> <li class=md-nav__item> <a href=#querying-scd-type-2-tables class=md-nav__link> <span class=md-ellipsis> Querying SCD Type 2 Tables </span> </a> </li> <li class=md-nav__item> <a href=#which-attributes-should-be-scd-type-2 class=md-nav__link> <span class=md-ellipsis> Which Attributes Should Be SCD Type 2? </span> </a> </li> <li class=md-nav__item> <a href=#etl-pipeline-for-scd-type-2 class=md-nav__link> <span class=md-ellipsis> ETL Pipeline for SCD Type 2 </span> </a> </li> <li class=md-nav__item> <a href=#why-this-matters_4 class=md-nav__link> <span class=md-ellipsis> Why This Matters </span> </a> </li> <li class=md-nav__item> <a href=#try-it_4 class=md-nav__link> <span class=md-ellipsis> Try It </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#common-pitfalls class=md-nav__link> <span class=md-ellipsis> Common Pitfalls </span> </a> <nav class=md-nav aria-label="Common Pitfalls"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-querying-fact-with-natural-key-instead-of-surrogate-key class=md-nav__link> <span class=md-ellipsis> 1. Querying Fact with Natural Key Instead of Surrogate Key </span> </a> </li> <li class=md-nav__item> <a href=#2-not-choosing-partition-key-based-on-query-patterns class=md-nav__link> <span class=md-ellipsis> 2. Not Choosing Partition Key Based on Query Patterns </span> </a> </li> <li class=md-nav__item> <a href=#3-over-clustering class=md-nav__link> <span class=md-ellipsis> 3. Over-Clustering </span> </a> </li> <li class=md-nav__item> <a href=#4-not-handling-dimension-load-order class=md-nav__link> <span class=md-ellipsis> 4. Not Handling Dimension Load Order </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#reflection-questions class=md-nav__link> <span class=md-ellipsis> Reflection Questions </span> </a> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=chapter-4-data-warehousing-bigquery>Chapter 4: Data Warehousing &amp; BigQuery<a class=headerlink href=#chapter-4-data-warehousing-bigquery title="Permanent link">&para;</a></h1> <h2 id=learning-objectives>Learning Objectives<a class=headerlink href=#learning-objectives title="Permanent link">&para;</a></h2> <p>By the end of this chapter, you will be able to: 1. <strong>Design</strong> dimensional models using star and snowflake schemas for analytical workloads 2. <strong>Evaluate</strong> when to use star vs. snowflake schema based on query patterns and data characteristics 3. <strong>Implement</strong> partitioning and clustering strategies in BigQuery to optimize query performance and costs 4. <strong>Create</strong> Slowly Changing Dimension (SCD) Type 2 implementations to track historical data changes</p> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>Your VP of Product walks into your office on Monday morning: "I need a report by Wednesday. Show me our top-selling products by category for Q4, broken down by customer segment and region. Oh, and I need to see how those numbers compare to Q3 and last year."</p> <p>You open your production PostgreSQL database—the one that powers your e-commerce platform. You write a query. It's running. Still running. Five minutes later, it's still running. You check the database metrics: CPU at 95%, query queue backing up, API response times spiking. Your operations team is paging you about slow checkout times.</p> <p>You just learned a painful lesson: <strong>operational databases aren't built for analytics</strong>. Your OLTP (Online Transaction Processing) database is optimized for fast INSERTs, UPDATEs, and simple lookups. But analytical queries—the ones that aggregate millions of rows, join across many tables, and compare historical periods—bring it to its knees.</p> <p>This is why data warehouses exist. They're purpose-built for analytics: denormalized schemas, columnar storage, massive parallelism, and optimizations for read-heavy workloads. In this chapter, you'll learn how to design schemas specifically for analytics, understand the trade-offs between different modeling approaches, and leverage BigQuery's unique features to build cost-effective, high-performance data warehouses.</p> <p>Let's start with the fundamental question: what makes a warehouse different from a database?</p> <h2 id=section-1-oltp-vs-olap-two-different-worlds>Section 1: OLTP vs OLAP - Two Different Worlds<a class=headerlink href=#section-1-oltp-vs-olap-two-different-worlds title="Permanent link">&para;</a></h2> <h3 id=key-idea>Key Idea<a class=headerlink href=#key-idea title="Permanent link">&para;</a></h3> <p>OLTP systems optimize for transactional consistency and fast writes, while OLAP systems optimize for analytical queries and fast reads. The schema design, storage format, and query patterns are fundamentally different.</p> <h3 id=example-the-same-question-two-systems>Example: The Same Question, Two Systems<a class=headerlink href=#example-the-same-question-two-systems title="Permanent link">&para;</a></h3> <p><strong>Business Question:</strong> "What were our total sales last month by product category?"</p> <p><strong>OLTP Database (PostgreSQL - Normalized Schema):</strong></p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>-- Schema: Normalized for transactional integrity</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=n>order_id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=w>    </span><span class=n>order_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=w>    </span><span class=n>status</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=p>);</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>    </span><span class=n>order_item_id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=w>    </span><span class=n>order_id</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>    </span><span class=n>quantity</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>    </span><span class=n>price</span><span class=w> </span><span class=nb>DECIMAL</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=p>);</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>    </span><span class=n>product_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=w>    </span><span class=n>category_id</span><span class=w> </span><span class=nb>INT</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=p>);</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=w>    </span><span class=n>category_id</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=w>    </span><span class=n>category_name</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=p>);</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=c1>-- Query: Multiple joins, slow on large tables</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=k>SELECT</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=w>    </span><span class=k>c</span><span class=p>.</span><span class=n>category_name</span><span class=p>,</span>
</span><span id=__span-0-31><a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>oi</span><span class=p>.</span><span class=n>quantity</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>price</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_sales</span>
</span><span id=__span-0-32><a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=k>FROM</span><span class=w> </span><span class=n>order_items</span><span class=w> </span><span class=n>oi</span>
</span><span id=__span-0-33><a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=k>JOIN</span><span class=w> </span><span class=n>orders</span><span class=w> </span><span class=n>o</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>order_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_id</span>
</span><span id=__span-0-34><a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=k>JOIN</span><span class=w> </span><span class=n>products</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>oi</span><span class=p>.</span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_id</span>
</span><span id=__span-0-35><a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=k>JOIN</span><span class=w> </span><span class=n>categories</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>category_id</span>
</span><span id=__span-0-36><a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=k>WHERE</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=s1>&#39;2024-01-01&#39;</span>
</span><span id=__span-0-37><a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>order_date</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=s1>&#39;2024-02-01&#39;</span>
</span><span id=__span-0-38><a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>o</span><span class=p>.</span><span class=n>status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;completed&#39;</span>
</span><span id=__span-0-39><a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>category_name</span><span class=p>;</span>
</span><span id=__span-0-40><a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>
</span><span id=__span-0-41><a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=c1>-- Performance: 15 seconds on 100M rows</span>
</span><span id=__span-0-42><a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=c1>-- Impact: Locks tables, slows down production transactions</span>
</span></code></pre></div> <p><strong>OLAP Data Warehouse (BigQuery - Star Schema):</strong></p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>-- Schema: Denormalized for analytical performance</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=n>sale_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>    </span><span class=n>order_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=n>category_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=c1>-- Denormalized attributes for fast filtering</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=n>category_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=w>    </span><span class=n>product_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a><span class=w>    </span><span class=n>customer_segment</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=w>    </span><span class=n>region</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=w>    </span><span class=c1>-- Metrics</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=w>    </span><span class=n>quantity</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a><span class=w>    </span><span class=n>unit_price</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=w>    </span><span class=n>sales_amount</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=w>    </span><span class=n>cost_amount</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=w>    </span><span class=n>profit_amount</span><span class=w> </span><span class=nb>NUMERIC</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=p>)</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>order_date</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>category_name</span><span class=p>,</span><span class=w> </span><span class=n>region</span><span class=p>;</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=c1>-- Query: No joins needed, blazing fast</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=k>SELECT</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>    </span><span class=n>category_name</span><span class=p>,</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>sales_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_sales</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=k>WHERE</span><span class=w> </span><span class=n>order_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=s1>&#39;2024-01-01&#39;</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>order_date</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=s1>&#39;2024-02-01&#39;</span>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>category_name</span><span class=p>;</span>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=c1>-- Performance: 800ms on 100M rows</span>
</span><span id=__span-1-33><a id=__codelineno-1-33 name=__codelineno-1-33 href=#__codelineno-1-33></a><span class=c1>-- Impact: No impact on production system (separate database)</span>
</span></code></pre></div> <h3 id=key-differences>Key Differences<a class=headerlink href=#key-differences title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Aspect</th> <th>OLTP (Database)</th> <th>OLAP (Warehouse)</th> </tr> </thead> <tbody> <tr> <td><strong>Purpose</strong></td> <td>Run the business</td> <td>Analyze the business</td> </tr> <tr> <td><strong>Workload</strong></td> <td>Many small transactions</td> <td>Few large queries</td> </tr> <tr> <td><strong>Schema</strong></td> <td>Normalized (3NF)</td> <td>Denormalized (star/snowflake)</td> </tr> <tr> <td><strong>Writes</strong></td> <td>Frequent INSERTs/UPDATEs</td> <td>Batch loads (ETL)</td> </tr> <tr> <td><strong>Reads</strong></td> <td>Simple lookups (by ID)</td> <td>Complex aggregations</td> </tr> <tr> <td><strong>Storage</strong></td> <td>Row-oriented</td> <td>Column-oriented</td> </tr> <tr> <td><strong>Query Pattern</strong></td> <td>"Get order #12345"</td> <td>"Sum all sales by category"</td> </tr> <tr> <td><strong>Typical Size</strong></td> <td>GB to low TB</td> <td>TB to PB</td> </tr> <tr> <td><strong>Users</strong></td> <td>Thousands (customers, app)</td> <td>Dozens (analysts, executives)</td> </tr> </tbody> </table> <h3 id=why-column-oriented-storage-matters>Why Column-Oriented Storage Matters<a class=headerlink href=#why-column-oriented-storage-matters title="Permanent link">&para;</a></h3> <p><strong>Row-oriented (OLTP):</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>Row 1: [order_id=1, customer_id=100, order_date=&#39;2024-01-15&#39;, amount=50.00]
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>Row 2: [order_id=2, customer_id=101, order_date=&#39;2024-01-16&#39;, amount=75.00]
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>Row 3: [order_id=3, customer_id=100, order_date=&#39;2024-01-17&#39;, amount=120.00]
</span></code></pre></div> Reading all <code>amount</code> values requires reading all rows entirely.</p> <p><strong>Column-oriented (OLAP):</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>order_id:     [1, 2, 3, ...]
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>customer_id:  [100, 101, 100, ...]
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>order_date:   [&#39;2024-01-15&#39;, &#39;2024-01-16&#39;, &#39;2024-01-17&#39;, ...]
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>amount:       [50.00, 75.00, 120.00, ...]
</span></code></pre></div> Reading all <code>amount</code> values only requires reading the <code>amount</code> column.</p> <p><strong>Result:</strong> For analytical queries that aggregate columns, columnar storage is 10-100x faster.</p> <h3 id=why-this-matters>Why This Matters<a class=headerlink href=#why-this-matters title="Permanent link">&para;</a></h3> <p>In data engineering: - <strong>Don't run analytics on production databases</strong> - it slows down your application - <strong>Separate OLTP and OLAP systems</strong> - ETL pipelines move data from one to the other - <strong>Schema design depends on use case</strong> - normalize for transactions, denormalize for analytics</p> <p>Real-world architecture: <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>OLTP (PostgreSQL)  →  ETL Pipeline (Airflow)  →  OLAP (BigQuery)
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>   ↓                         ↓                          ↓
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>Application logic      Transform &amp; load          Analytics queries
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>Fast writes            Scheduled nightly         Fast aggregations
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>Normalized schema      Data quality checks       Denormalized schema
</span></code></pre></div></p> <h3 id=try-it>Try It<a class=headerlink href=#try-it title="Permanent link">&para;</a></h3> <p>Think about these queries. Which should run on OLTP? Which on OLAP?</p> <ol> <li>"Show me order #54321 with all its items"</li> <li>"What's the average order value by day for the past year?"</li> <li>"Update customer #123's email address"</li> <li>"Which products have the highest profit margin by region and quarter?"</li> <li>"Check if product #789 is in stock"</li> </ol> <details> <summary>Answers</summary> 1. **OLTP** - Simple lookup by primary key 2. **OLAP** - Aggregation over large time range 3. **OLTP** - Transactional update 4. **OLAP** - Complex analytical aggregation 5. **OLTP** - Simple lookup for application logic </details> <h2 id=section-2-star-schema-the-foundation-of-data-warehousing>Section 2: Star Schema - The Foundation of Data Warehousing<a class=headerlink href=#section-2-star-schema-the-foundation-of-data-warehousing title="Permanent link">&para;</a></h2> <h3 id=key-idea_1>Key Idea<a class=headerlink href=#key-idea_1 title="Permanent link">&para;</a></h3> <p>Star schema organizes data into fact tables (metrics/events) and dimension tables (descriptive attributes). This structure optimizes for analytical queries while remaining intuitive and maintainable.</p> <h3 id=example-e-commerce-analytics-warehouse>Example: E-Commerce Analytics Warehouse<a class=headerlink href=#example-e-commerce-analytics-warehouse title="Permanent link">&para;</a></h3> <p><strong>Business Requirement:</strong> "Analyze sales performance across products, customers, time, and locations."</p> <p><strong>Star Schema Design:</strong></p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1>-- FACT TABLE: The center of the star</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=c1>-- Contains metrics and foreign keys to dimensions</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=n>sale_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Surrogate key for the fact</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=w>    </span><span class=c1>-- Foreign keys to dimensions</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span><span class=n>date_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>    </span><span class=n>customer_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=w>    </span><span class=n>product_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>    </span><span class=n>store_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=c1>-- Degenerate dimensions (non-foreign key attributes)</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>    </span><span class=n>order_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>    </span><span class=n>invoice_number</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=w>    </span><span class=c1>-- Metrics (what we&#39;re measuring)</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a><span class=w>    </span><span class=n>quantity</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a><span class=w>    </span><span class=n>unit_price</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a><span class=w>    </span><span class=n>discount_amount</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=w>    </span><span class=n>sales_amount</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Extended price</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>    </span><span class=n>cost_amount</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a><span class=w>    </span><span class=n>profit_amount</span><span class=w> </span><span class=nb>NUMERIC</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a><span class=p>)</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>DATE_TRUNC</span><span class=p>(</span><span class=n>date_key</span><span class=p>,</span><span class=w> </span><span class=k>MONTH</span><span class=p>)</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>product_key</span><span class=p>,</span><span class=w> </span><span class=n>store_key</span><span class=p>;</span>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=c1>-- DIMENSION: Time/Date</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a><span class=c1>-- Pre-built calendar with useful attributes</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_date</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a><span class=w>    </span><span class=n>date_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 20240115 for Jan 15, 2024</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a><span class=w>    </span><span class=n>full_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a><span class=w>    </span><span class=n>day_of_week</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Monday&#39;</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a><span class=w>    </span><span class=n>day_of_week_num</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 1</span>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a><span class=w>    </span><span class=n>day_of_month</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 15</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a><span class=w>    </span><span class=n>day_of_year</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 15</span>
</span><span id=__span-5-33><a id=__codelineno-5-33 name=__codelineno-5-33 href=#__codelineno-5-33></a><span class=w>    </span><span class=n>week_of_year</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 3</span>
</span><span id=__span-5-34><a id=__codelineno-5-34 name=__codelineno-5-34 href=#__codelineno-5-34></a><span class=w>    </span><span class=n>month_num</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 1</span>
</span><span id=__span-5-35><a id=__codelineno-5-35 name=__codelineno-5-35 href=#__codelineno-5-35></a><span class=w>    </span><span class=n>month_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;January&#39;</span>
</span><span id=__span-5-36><a id=__codelineno-5-36 name=__codelineno-5-36 href=#__codelineno-5-36></a><span class=w>    </span><span class=n>month_abbr</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Jan&#39;</span>
</span><span id=__span-5-37><a id=__codelineno-5-37 name=__codelineno-5-37 href=#__codelineno-5-37></a><span class=w>    </span><span class=n>quarter</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 1</span>
</span><span id=__span-5-38><a id=__codelineno-5-38 name=__codelineno-5-38 href=#__codelineno-5-38></a><span class=w>    </span><span class=k>year</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 2024</span>
</span><span id=__span-5-39><a id=__codelineno-5-39 name=__codelineno-5-39 href=#__codelineno-5-39></a><span class=w>    </span><span class=n>is_weekend</span><span class=w> </span><span class=n>BOOL</span><span class=p>,</span><span class=w>  </span><span class=c1>-- false</span>
</span><span id=__span-5-40><a id=__codelineno-5-40 name=__codelineno-5-40 href=#__codelineno-5-40></a><span class=w>    </span><span class=n>is_holiday</span><span class=w> </span><span class=n>BOOL</span><span class=p>,</span><span class=w>  </span><span class=c1>-- false</span>
</span><span id=__span-5-41><a id=__codelineno-5-41 name=__codelineno-5-41 href=#__codelineno-5-41></a><span class=w>    </span><span class=n>holiday_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- null</span>
</span><span id=__span-5-42><a id=__codelineno-5-42 name=__codelineno-5-42 href=#__codelineno-5-42></a><span class=w>    </span><span class=n>fiscal_year</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 2024</span>
</span><span id=__span-5-43><a id=__codelineno-5-43 name=__codelineno-5-43 href=#__codelineno-5-43></a><span class=w>    </span><span class=n>fiscal_quarter</span><span class=w> </span><span class=n>INT64</span><span class=w>  </span><span class=c1>-- 1</span>
</span><span id=__span-5-44><a id=__codelineno-5-44 name=__codelineno-5-44 href=#__codelineno-5-44></a><span class=p>);</span>
</span><span id=__span-5-45><a id=__codelineno-5-45 name=__codelineno-5-45 href=#__codelineno-5-45></a>
</span><span id=__span-5-46><a id=__codelineno-5-46 name=__codelineno-5-46 href=#__codelineno-5-46></a><span class=c1>-- DIMENSION: Customer</span>
</span><span id=__span-5-47><a id=__codelineno-5-47 name=__codelineno-5-47 href=#__codelineno-5-47></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-5-48><a id=__codelineno-5-48 name=__codelineno-5-48 href=#__codelineno-5-48></a><span class=w>    </span><span class=n>customer_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Surrogate key</span>
</span><span id=__span-5-49><a id=__codelineno-5-49 name=__codelineno-5-49 href=#__codelineno-5-49></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Natural key from source system</span>
</span><span id=__span-5-50><a id=__codelineno-5-50 name=__codelineno-5-50 href=#__codelineno-5-50></a><span class=w>    </span><span class=n>customer_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-51><a id=__codelineno-5-51 name=__codelineno-5-51 href=#__codelineno-5-51></a><span class=w>    </span><span class=n>email</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-52><a id=__codelineno-5-52 name=__codelineno-5-52 href=#__codelineno-5-52></a><span class=w>    </span><span class=n>phone</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-53><a id=__codelineno-5-53 name=__codelineno-5-53 href=#__codelineno-5-53></a><span class=w>    </span><span class=c1>-- Segmentation attributes</span>
</span><span id=__span-5-54><a id=__codelineno-5-54 name=__codelineno-5-54 href=#__codelineno-5-54></a><span class=w>    </span><span class=n>customer_segment</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Premium&#39;, &#39;Standard&#39;, &#39;Basic&#39;</span>
</span><span id=__span-5-55><a id=__codelineno-5-55 name=__codelineno-5-55 href=#__codelineno-5-55></a><span class=w>    </span><span class=n>customer_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Individual&#39;, &#39;Business&#39;</span>
</span><span id=__span-5-56><a id=__codelineno-5-56 name=__codelineno-5-56 href=#__codelineno-5-56></a><span class=w>    </span><span class=n>signup_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-5-57><a id=__codelineno-5-57 name=__codelineno-5-57 href=#__codelineno-5-57></a><span class=w>    </span><span class=c1>-- SCD Type 2 columns (more on this later)</span>
</span><span id=__span-5-58><a id=__codelineno-5-58 name=__codelineno-5-58 href=#__codelineno-5-58></a><span class=w>    </span><span class=n>effective_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-5-59><a id=__codelineno-5-59 name=__codelineno-5-59 href=#__codelineno-5-59></a><span class=w>    </span><span class=n>expiration_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-5-60><a id=__codelineno-5-60 name=__codelineno-5-60 href=#__codelineno-5-60></a><span class=w>    </span><span class=n>is_current</span><span class=w> </span><span class=n>BOOL</span>
</span><span id=__span-5-61><a id=__codelineno-5-61 name=__codelineno-5-61 href=#__codelineno-5-61></a><span class=p>);</span>
</span><span id=__span-5-62><a id=__codelineno-5-62 name=__codelineno-5-62 href=#__codelineno-5-62></a>
</span><span id=__span-5-63><a id=__codelineno-5-63 name=__codelineno-5-63 href=#__codelineno-5-63></a><span class=c1>-- DIMENSION: Product</span>
</span><span id=__span-5-64><a id=__codelineno-5-64 name=__codelineno-5-64 href=#__codelineno-5-64></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-5-65><a id=__codelineno-5-65 name=__codelineno-5-65 href=#__codelineno-5-65></a><span class=w>    </span><span class=n>product_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-5-66><a id=__codelineno-5-66 name=__codelineno-5-66 href=#__codelineno-5-66></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-67><a id=__codelineno-5-67 name=__codelineno-5-67 href=#__codelineno-5-67></a><span class=w>    </span><span class=n>product_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-68><a id=__codelineno-5-68 name=__codelineno-5-68 href=#__codelineno-5-68></a><span class=w>    </span><span class=n>product_description</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-69><a id=__codelineno-5-69 name=__codelineno-5-69 href=#__codelineno-5-69></a><span class=w>    </span><span class=c1>-- Hierarchy attributes</span>
</span><span id=__span-5-70><a id=__codelineno-5-70 name=__codelineno-5-70 href=#__codelineno-5-70></a><span class=w>    </span><span class=n>category</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Electronics&#39;</span>
</span><span id=__span-5-71><a id=__codelineno-5-71 name=__codelineno-5-71 href=#__codelineno-5-71></a><span class=w>    </span><span class=n>subcategory</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Laptops&#39;</span>
</span><span id=__span-5-72><a id=__codelineno-5-72 name=__codelineno-5-72 href=#__codelineno-5-72></a><span class=w>    </span><span class=n>brand</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Apple&#39;</span>
</span><span id=__span-5-73><a id=__codelineno-5-73 name=__codelineno-5-73 href=#__codelineno-5-73></a><span class=w>    </span><span class=c1>-- Product attributes</span>
</span><span id=__span-5-74><a id=__codelineno-5-74 name=__codelineno-5-74 href=#__codelineno-5-74></a><span class=w>    </span><span class=n>color</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-75><a id=__codelineno-5-75 name=__codelineno-5-75 href=#__codelineno-5-75></a><span class=w>    </span><span class=k>size</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-76><a id=__codelineno-5-76 name=__codelineno-5-76 href=#__codelineno-5-76></a><span class=w>    </span><span class=n>weight</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-5-77><a id=__codelineno-5-77 name=__codelineno-5-77 href=#__codelineno-5-77></a><span class=w>    </span><span class=n>unit_cost</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-5-78><a id=__codelineno-5-78 name=__codelineno-5-78 href=#__codelineno-5-78></a><span class=w>    </span><span class=n>unit_price</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-5-79><a id=__codelineno-5-79 name=__codelineno-5-79 href=#__codelineno-5-79></a><span class=w>    </span><span class=n>is_active</span><span class=w> </span><span class=n>BOOL</span>
</span><span id=__span-5-80><a id=__codelineno-5-80 name=__codelineno-5-80 href=#__codelineno-5-80></a><span class=p>);</span>
</span><span id=__span-5-81><a id=__codelineno-5-81 name=__codelineno-5-81 href=#__codelineno-5-81></a>
</span><span id=__span-5-82><a id=__codelineno-5-82 name=__codelineno-5-82 href=#__codelineno-5-82></a><span class=c1>-- DIMENSION: Store/Location</span>
</span><span id=__span-5-83><a id=__codelineno-5-83 name=__codelineno-5-83 href=#__codelineno-5-83></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_store</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-5-84><a id=__codelineno-5-84 name=__codelineno-5-84 href=#__codelineno-5-84></a><span class=w>    </span><span class=n>store_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-5-85><a id=__codelineno-5-85 name=__codelineno-5-85 href=#__codelineno-5-85></a><span class=w>    </span><span class=n>store_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-86><a id=__codelineno-5-86 name=__codelineno-5-86 href=#__codelineno-5-86></a><span class=w>    </span><span class=n>store_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-87><a id=__codelineno-5-87 name=__codelineno-5-87 href=#__codelineno-5-87></a><span class=w>    </span><span class=c1>-- Geographic hierarchy</span>
</span><span id=__span-5-88><a id=__codelineno-5-88 name=__codelineno-5-88 href=#__codelineno-5-88></a><span class=w>    </span><span class=n>address</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-89><a id=__codelineno-5-89 name=__codelineno-5-89 href=#__codelineno-5-89></a><span class=w>    </span><span class=n>city</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-90><a id=__codelineno-5-90 name=__codelineno-5-90 href=#__codelineno-5-90></a><span class=w>    </span><span class=k>state</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-91><a id=__codelineno-5-91 name=__codelineno-5-91 href=#__codelineno-5-91></a><span class=w>    </span><span class=n>country</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-92><a id=__codelineno-5-92 name=__codelineno-5-92 href=#__codelineno-5-92></a><span class=w>    </span><span class=n>region</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;West Coast&#39;, &#39;Northeast&#39;</span>
</span><span id=__span-5-93><a id=__codelineno-5-93 name=__codelineno-5-93 href=#__codelineno-5-93></a><span class=w>    </span><span class=c1>-- Store attributes</span>
</span><span id=__span-5-94><a id=__codelineno-5-94 name=__codelineno-5-94 href=#__codelineno-5-94></a><span class=w>    </span><span class=n>store_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Flagship&#39;, &#39;Outlet&#39;, &#39;Online&#39;</span>
</span><span id=__span-5-95><a id=__codelineno-5-95 name=__codelineno-5-95 href=#__codelineno-5-95></a><span class=w>    </span><span class=n>square_footage</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-5-96><a id=__codelineno-5-96 name=__codelineno-5-96 href=#__codelineno-5-96></a><span class=w>    </span><span class=n>manager_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-5-97><a id=__codelineno-5-97 name=__codelineno-5-97 href=#__codelineno-5-97></a><span class=w>    </span><span class=n>open_date</span><span class=w> </span><span class=nb>DATE</span>
</span><span id=__span-5-98><a id=__codelineno-5-98 name=__codelineno-5-98 href=#__codelineno-5-98></a><span class=p>);</span>
</span></code></pre></div> <p><strong>Why This Design?</strong></p> <ol> <li><strong>Fact table is long and narrow</strong>: Many rows, focused columns</li> <li><strong>Dimension tables are short and wide</strong>: Fewer rows, many descriptive attributes</li> <li><strong>Star shape</strong>: Fact table in the center, dimensions around it (no joins between dimensions)</li> <li><strong>Queries are simple</strong>: Join fact to dimensions, filter/group by dimension attributes</li> </ol> <h3 id=example-queries>Example Queries<a class=headerlink href=#example-queries title="Permanent link">&para;</a></h3> <p><strong>Query 1: Sales by Product Category</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>SELECT</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=n>p</span><span class=p>.</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_sales</span><span class=p>,</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>quantity</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_quantity</span><span class=p>,</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=w>    </span><span class=k>COUNT</span><span class=p>(</span><span class=k>DISTINCT</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>customer_key</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>unique_customers</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>product_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_key</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=k>WHERE</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>date_key</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>20240101</span><span class=w>  </span><span class=c1>-- Jan 1, 2024</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>date_key</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>20240201</span><span class=w>  </span><span class=c1>-- Feb 1, 2024</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>total_sales</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Query 2: Sales Trends by Month</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=k>SELECT</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=w>    </span><span class=n>d</span><span class=p>.</span><span class=k>year</span><span class=p>,</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>    </span><span class=n>d</span><span class=p>.</span><span class=n>month_name</span><span class=p>,</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>monthly_sales</span><span class=p>,</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=w>    </span><span class=k>AVG</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>profit_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>avg_profit_per_sale</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_date</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>date_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>date_key</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=k>year</span><span class=p>,</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>month_num</span><span class=p>,</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>month_name</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=k>year</span><span class=p>,</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>month_num</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Query 3: Top Customers by Region</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>SELECT</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>    </span><span class=n>s</span><span class=p>.</span><span class=n>region</span><span class=p>,</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=k>c</span><span class=p>.</span><span class=n>customer_name</span><span class=p>,</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_spent</span><span class=p>,</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=k>COUNT</span><span class=p>(</span><span class=k>DISTINCT</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>sale_id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>order_count</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>customer_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>customer_key</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_store</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>store_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>store_key</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>customer_segment</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Premium&#39;</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>date_key</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>20240101</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>region</span><span class=p>,</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>customer_key</span><span class=p>,</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>customer_name</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=n>region</span><span class=p>,</span><span class=w> </span><span class=n>total_spent</span><span class=w> </span><span class=k>DESC</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Query 4: Weekend vs. Weekday Sales</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=k>SELECT</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=w>    </span><span class=n>d</span><span class=p>.</span><span class=n>is_weekend</span><span class=p>,</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>    </span><span class=k>AVG</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>avg_transaction_value</span><span class=p>,</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>    </span><span class=k>COUNT</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>transaction_count</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_date</span><span class=w> </span><span class=n>d</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>date_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>date_key</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>d</span><span class=p>.</span><span class=n>is_weekend</span><span class=p>;</span>
</span></code></pre></div></p> <h3 id=design-principles>Design Principles<a class=headerlink href=#design-principles title="Permanent link">&para;</a></h3> <p><strong>1. Surrogate Keys</strong></p> <p>Use artificial keys instead of natural keys: <div class="language-sql highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1>-- Bad: Use source system ID as primary key</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>STRING</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>  </span><span class=c1>-- What if ID changes in source?</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=p>...</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=p>);</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=c1>-- Good: Use surrogate key</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a><span class=w>    </span><span class=n>customer_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Generated in warehouse</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Natural key from source</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=w>    </span><span class=p>...</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=p>);</span>
</span></code></pre></div></p> <p><strong>Benefits:</strong> - Handles source system ID changes - Supports Slowly Changing Dimensions (SCD) - Improves join performance (INT vs. STRING) - Decouples warehouse from source systems</p> <p><strong>2. Conformed Dimensions</strong></p> <p>Shared dimensions across multiple fact tables: <div class="language-sql highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1>-- Same dim_customer used by multiple facts</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=n>fact_sales</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_customer</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=n>fact_returns</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_customer</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=n>fact_support_tickets</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_customer</span>
</span></code></pre></div></p> <p>This enables cross-functional analysis: "Which customers buy a lot but also have many support tickets?"</p> <p><strong>3. Grain Declaration</strong></p> <p>The <strong>grain</strong> is the level of detail in the fact table. Be explicit!</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1>-- Grain: One row per line item on an order</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=c1>-- (Order #123 with 3 products = 3 fact rows)</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=n>fact_sales</span><span class=w> </span><span class=p>(</span><span class=n>sale_id</span><span class=p>,</span><span class=w> </span><span class=n>date_key</span><span class=p>,</span><span class=w> </span><span class=n>customer_key</span><span class=p>,</span><span class=w> </span><span class=n>product_key</span><span class=p>,</span><span class=w> </span><span class=p>...)</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=c1>-- Different grain: One row per order</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=c1>-- (Order #123 with 3 products = 1 fact row)</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=n>fact_orders</span><span class=w> </span><span class=p>(</span><span class=n>order_id</span><span class=p>,</span><span class=w> </span><span class=n>date_key</span><span class=p>,</span><span class=w> </span><span class=n>customer_key</span><span class=p>,</span><span class=w> </span><span class=n>order_total</span><span class=p>,</span><span class=w> </span><span class=p>...)</span>
</span></code></pre></div> <p><strong>Rule:</strong> All facts and dimensions must match the declared grain.</p> <h3 id=why-this-matters_1>Why This Matters<a class=headerlink href=#why-this-matters_1 title="Permanent link">&para;</a></h3> <p>Star schema provides: - <strong>Query performance</strong>: Few joins, columnar scans - <strong>Simplicity</strong>: Business users can understand the model - <strong>Flexibility</strong>: Add new dimensions without restructuring facts - <strong>Consistency</strong>: Conformed dimensions ensure consistent reporting</p> <p>In data engineering: - <strong>ETL complexity</strong>: You build pipelines to populate these tables - <strong>Data quality</strong>: Dimension lookups must succeed (no orphaned facts) - <strong>Historical tracking</strong>: Dimensions change over time (next section!)</p> <h3 id=try-it_1>Try It<a class=headerlink href=#try-it_1 title="Permanent link">&para;</a></h3> <p>Design a star schema for a music streaming service. Requirements:</p> <ul> <li>Analyze song plays by user, song, time, and device</li> <li>Track metrics: play count, duration, skip rate</li> <li>Dimensions: user demographics, song attributes, artist info, device type</li> </ul> <p>Sketch out: 1. Fact table name and columns 2. At least 4 dimension tables with key attributes</p> <details> <summary>Solution</summary> <div class="language-sql highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1>-- FACT: Song plays</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>fact_plays</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>    </span><span class=n>play_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>    </span><span class=n>date_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>    </span><span class=n>user_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>    </span><span class=n>song_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>    </span><span class=n>artist_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>    </span><span class=n>device_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>    </span><span class=c1>-- Metrics</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>    </span><span class=n>play_duration_seconds</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>    </span><span class=n>was_skipped</span><span class=w> </span><span class=n>BOOL</span><span class=p>,</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>    </span><span class=n>was_completed</span><span class=w> </span><span class=n>BOOL</span><span class=p>,</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>    </span><span class=n>play_timestamp</span><span class=w> </span><span class=k>TIMESTAMP</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=p>);</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=c1>-- DIMENSION: Date (same as before)</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=c1>-- DIMENSION: User</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_user</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a><span class=w>    </span><span class=n>user_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=w>    </span><span class=n>username</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>    </span><span class=n>country</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=w>    </span><span class=n>subscription_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Free&#39;, &#39;Premium&#39;</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>    </span><span class=n>signup_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=w>    </span><span class=n>age_group</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=w>    </span><span class=n>gender</span><span class=w> </span><span class=n>STRING</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=p>);</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a><span class=c1>-- DIMENSION: Song</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_song</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=w>    </span><span class=n>song_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=w>    </span><span class=n>song_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-34><a id=__codelineno-13-34 name=__codelineno-13-34 href=#__codelineno-13-34></a><span class=w>    </span><span class=n>song_title</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-35><a id=__codelineno-13-35 name=__codelineno-13-35 href=#__codelineno-13-35></a><span class=w>    </span><span class=n>duration_seconds</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-13-36><a id=__codelineno-13-36 name=__codelineno-13-36 href=#__codelineno-13-36></a><span class=w>    </span><span class=n>genre</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-37><a id=__codelineno-13-37 name=__codelineno-13-37 href=#__codelineno-13-37></a><span class=w>    </span><span class=n>subgenre</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-38><a id=__codelineno-13-38 name=__codelineno-13-38 href=#__codelineno-13-38></a><span class=w>    </span><span class=n>release_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-13-39><a id=__codelineno-13-39 name=__codelineno-13-39 href=#__codelineno-13-39></a><span class=w>    </span><span class=n>explicit</span><span class=w> </span><span class=n>BOOL</span><span class=p>,</span>
</span><span id=__span-13-40><a id=__codelineno-13-40 name=__codelineno-13-40 href=#__codelineno-13-40></a><span class=w>    </span><span class=n>popularity_score</span><span class=w> </span><span class=n>INT64</span>
</span><span id=__span-13-41><a id=__codelineno-13-41 name=__codelineno-13-41 href=#__codelineno-13-41></a><span class=p>);</span>
</span><span id=__span-13-42><a id=__codelineno-13-42 name=__codelineno-13-42 href=#__codelineno-13-42></a>
</span><span id=__span-13-43><a id=__codelineno-13-43 name=__codelineno-13-43 href=#__codelineno-13-43></a><span class=c1>-- DIMENSION: Artist</span>
</span><span id=__span-13-44><a id=__codelineno-13-44 name=__codelineno-13-44 href=#__codelineno-13-44></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_artist</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-13-45><a id=__codelineno-13-45 name=__codelineno-13-45 href=#__codelineno-13-45></a><span class=w>    </span><span class=n>artist_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-13-46><a id=__codelineno-13-46 name=__codelineno-13-46 href=#__codelineno-13-46></a><span class=w>    </span><span class=n>artist_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-47><a id=__codelineno-13-47 name=__codelineno-13-47 href=#__codelineno-13-47></a><span class=w>    </span><span class=n>artist_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-48><a id=__codelineno-13-48 name=__codelineno-13-48 href=#__codelineno-13-48></a><span class=w>    </span><span class=n>country</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-49><a id=__codelineno-13-49 name=__codelineno-13-49 href=#__codelineno-13-49></a><span class=w>    </span><span class=n>genre</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-50><a id=__codelineno-13-50 name=__codelineno-13-50 href=#__codelineno-13-50></a><span class=w>    </span><span class=n>follower_count</span><span class=w> </span><span class=n>INT64</span>
</span><span id=__span-13-51><a id=__codelineno-13-51 name=__codelineno-13-51 href=#__codelineno-13-51></a><span class=p>);</span>
</span><span id=__span-13-52><a id=__codelineno-13-52 name=__codelineno-13-52 href=#__codelineno-13-52></a>
</span><span id=__span-13-53><a id=__codelineno-13-53 name=__codelineno-13-53 href=#__codelineno-13-53></a><span class=c1>-- DIMENSION: Device</span>
</span><span id=__span-13-54><a id=__codelineno-13-54 name=__codelineno-13-54 href=#__codelineno-13-54></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_device</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-13-55><a id=__codelineno-13-55 name=__codelineno-13-55 href=#__codelineno-13-55></a><span class=w>    </span><span class=n>device_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-13-56><a id=__codelineno-13-56 name=__codelineno-13-56 href=#__codelineno-13-56></a><span class=w>    </span><span class=n>device_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- &#39;Mobile&#39;, &#39;Desktop&#39;, &#39;Smart Speaker&#39;</span>
</span><span id=__span-13-57><a id=__codelineno-13-57 name=__codelineno-13-57 href=#__codelineno-13-57></a><span class=w>    </span><span class=n>os</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-13-58><a id=__codelineno-13-58 name=__codelineno-13-58 href=#__codelineno-13-58></a><span class=w>    </span><span class=n>app_version</span><span class=w> </span><span class=n>STRING</span>
</span><span id=__span-13-59><a id=__codelineno-13-59 name=__codelineno-13-59 href=#__codelineno-13-59></a><span class=p>);</span>
</span></code></pre></div> </details> <h2 id=section-3-snowflake-schema-vs-star-schema>Section 3: Snowflake Schema vs. Star Schema<a class=headerlink href=#section-3-snowflake-schema-vs-star-schema title="Permanent link">&para;</a></h2> <h3 id=key-idea_2>Key Idea<a class=headerlink href=#key-idea_2 title="Permanent link">&para;</a></h3> <p>Snowflake schema normalizes dimension tables by splitting them into sub-dimensions. This reduces redundancy but increases query complexity. Choose based on your priorities: storage vs. simplicity.</p> <h3 id=example-product-dimension-normalization>Example: Product Dimension Normalization<a class=headerlink href=#example-product-dimension-normalization title="Permanent link">&para;</a></h3> <p><strong>Star Schema (Denormalized):</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=w>    </span><span class=n>product_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=w>    </span><span class=n>product_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>    </span><span class=c1>-- Category attributes (repeated for each product)</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=w>    </span><span class=n>category</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=w>    </span><span class=n>category_description</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=w>    </span><span class=c1>-- Subcategory attributes (repeated)</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=w>    </span><span class=n>subcategory</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>    </span><span class=n>subcategory_description</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>    </span><span class=c1>-- Brand attributes (repeated)</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>    </span><span class=n>brand</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=w>    </span><span class=n>brand_country</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a><span class=w>    </span><span class=n>brand_founded_year</span><span class=w> </span><span class=n>INT64</span>
</span><span id=__span-14-15><a id=__codelineno-14-15 name=__codelineno-14-15 href=#__codelineno-14-15></a><span class=p>);</span>
</span><span id=__span-14-16><a id=__codelineno-14-16 name=__codelineno-14-16 href=#__codelineno-14-16></a>
</span><span id=__span-14-17><a id=__codelineno-14-17 name=__codelineno-14-17 href=#__codelineno-14-17></a><span class=c1>-- Sample data shows redundancy:</span>
</span><span id=__span-14-18><a id=__codelineno-14-18 name=__codelineno-14-18 href=#__codelineno-14-18></a><span class=c1>-- product_key | product_name   | category | category_description  | brand | brand_country</span>
</span><span id=__span-14-19><a id=__codelineno-14-19 name=__codelineno-14-19 href=#__codelineno-14-19></a><span class=c1>-- 1           | iPhone 15      | Electronics | Electronic devices   | Apple | USA</span>
</span><span id=__span-14-20><a id=__codelineno-14-20 name=__codelineno-14-20 href=#__codelineno-14-20></a><span class=c1>-- 2           | MacBook Pro    | Electronics | Electronic devices   | Apple | USA</span>
</span><span id=__span-14-21><a id=__codelineno-14-21 name=__codelineno-14-21 href=#__codelineno-14-21></a><span class=c1>-- 3           | AirPods        | Electronics | Electronic devices   | Apple | USA</span>
</span></code></pre></div></p> <p>Notice: "Electronics", "Electronic devices", "Apple", "USA" are repeated for every Apple electronics product.</p> <p><strong>Snowflake Schema (Normalized):</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=w>    </span><span class=n>product_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>    </span><span class=n>product_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span><span class=n>subcategory_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Foreign key</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>    </span><span class=n>brand_key</span><span class=w> </span><span class=n>INT64</span><span class=w>         </span><span class=c1>-- Foreign key</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=p>);</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_subcategory</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a><span class=w>    </span><span class=n>subcategory_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=w>    </span><span class=n>subcategory</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>    </span><span class=n>subcategory_description</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=w>    </span><span class=n>category_key</span><span class=w> </span><span class=n>INT64</span><span class=w>  </span><span class=c1>-- Foreign key</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=p>);</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_category</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=w>    </span><span class=n>category_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=w>    </span><span class=n>category</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=w>    </span><span class=n>category_description</span><span class=w> </span><span class=n>STRING</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=p>);</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_brand</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=w>    </span><span class=n>brand_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=w>    </span><span class=n>brand</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a><span class=w>    </span><span class=n>brand_country</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=w>    </span><span class=n>brand_founded_year</span><span class=w> </span><span class=n>INT64</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=p>);</span>
</span></code></pre></div></p> <p><strong>Visual Comparison:</strong></p> <p>Star: <div class="language-text highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a>fact_sales → dim_product (contains all hierarchy levels)
</span></code></pre></div></p> <p>Snowflake: <div class="language-text highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a>fact_sales → dim_product → dim_subcategory → dim_category
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a>                         ↘ dim_brand
</span></code></pre></div></p> <h3 id=query-comparison>Query Comparison<a class=headerlink href=#query-comparison title="Permanent link">&para;</a></h3> <p><strong>Star Schema Query:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1>-- Simple: One join</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=k>SELECT</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=w>    </span><span class=n>p</span><span class=p>.</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=w>    </span><span class=n>p</span><span class=p>.</span><span class=n>brand</span><span class=p>,</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_sales</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>product_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_key</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>category</span><span class=p>,</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>brand</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Snowflake Schema Query:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1>-- Complex: Three joins</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=k>SELECT</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=w>    </span><span class=k>c</span><span class=p>.</span><span class=n>category</span><span class=p>,</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=w>    </span><span class=n>b</span><span class=p>.</span><span class=n>brand</span><span class=p>,</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>total_sales</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>product_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_key</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_subcategory</span><span class=w> </span><span class=n>sc</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>subcategory_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sc</span><span class=p>.</span><span class=n>subcategory_key</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_category</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>sc</span><span class=p>.</span><span class=n>category_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>category_key</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_brand</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>brand_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>brand_key</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>category</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>brand</span><span class=p>;</span>
</span></code></pre></div></p> <h3 id=trade-offs>Trade-offs<a class=headerlink href=#trade-offs title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Aspect</th> <th>Star Schema</th> <th>Snowflake Schema</th> </tr> </thead> <tbody> <tr> <td><strong>Query Simplicity</strong></td> <td>Simple (few joins)</td> <td>Complex (many joins)</td> </tr> <tr> <td><strong>Query Performance</strong></td> <td>Faster (fewer joins)</td> <td>Slower (more joins)</td> </tr> <tr> <td><strong>Storage</strong></td> <td>More (redundancy)</td> <td>Less (normalized)</td> </tr> <tr> <td><strong>Data Quality</strong></td> <td>Risk of inconsistency</td> <td>Enforced consistency</td> </tr> <tr> <td><strong>ETL Complexity</strong></td> <td>Simpler loads</td> <td>Complex with lookups</td> </tr> <tr> <td><strong>User Understanding</strong></td> <td>Easier (flatter)</td> <td>Harder (hierarchical)</td> </tr> </tbody> </table> <h3 id=when-to-use-snowflake-schema>When to Use Snowflake Schema<a class=headerlink href=#when-to-use-snowflake-schema title="Permanent link">&para;</a></h3> <p><strong>Choose Snowflake when:</strong> 1. <strong>Storage costs are high</strong> and data volume is massive 2. <strong>Dimension hierarchies change frequently</strong> (e.g., org charts) 3. <strong>Strong referential integrity is required</strong> 4. <strong>Multiple fact tables share sub-dimensions</strong></p> <p><strong>Example: Retail Chain with Complex Hierarchies</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1>-- Store dimension with geographic hierarchy</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=n>fact_sales</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_store</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_city</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_state</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_country</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_region</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1>-- Product dimension with category hierarchy</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=n>fact_sales</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_subcategory</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_category</span><span class=w> </span><span class=err>→</span><span class=w> </span><span class=n>dim_department</span>
</span></code></pre></div></p> <p>This prevents updating "California is in USA" across 500 store records.</p> <h3 id=hybrid-approach>Hybrid Approach<a class=headerlink href=#hybrid-approach title="Permanent link">&para;</a></h3> <p>In practice, many warehouses use a <strong>hybrid</strong>:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1>-- Star for stable dimensions</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=w>    </span><span class=n>customer_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=w>    </span><span class=n>customer_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=w>    </span><span class=n>customer_segment</span><span class=w> </span><span class=n>STRING</span><span class=w>  </span><span class=c1>-- Denormalized</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=p>);</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=c1>-- Snowflake for complex, changing hierarchies</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=w>    </span><span class=n>product_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=w>    </span><span class=n>product_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a><span class=w>    </span><span class=n>category_key</span><span class=w> </span><span class=n>INT64</span><span class=w>  </span><span class=c1>-- Normalized</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=p>);</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_category</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=w>    </span><span class=n>category_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=w>    </span><span class=n>category_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=w>    </span><span class=n>parent_category_key</span><span class=w> </span><span class=n>INT64</span><span class=w>  </span><span class=c1>-- Self-referencing hierarchy</span>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=p>);</span>
</span></code></pre></div> <h3 id=why-this-matters_2>Why This Matters<a class=headerlink href=#why-this-matters_2 title="Permanent link">&para;</a></h3> <p>In data engineering: - <strong>Star is the default</strong> for most use cases - <strong>Snowflake for specific needs</strong> (deep hierarchies, storage constraints) - <strong>Performance trumps theory</strong>: Test with your data and queries</p> <p>Real-world example: Amazon - <strong>Star for most dimensions</strong> (customer, date) - <strong>Snowflake for product categories</strong> (millions of products, complex taxonomies) - <strong>Performance optimization</strong>: Materialized joins for frequently queried snowflake paths</p> <h3 id=try-it_2>Try It<a class=headerlink href=#try-it_2 title="Permanent link">&para;</a></h3> <p>Convert this denormalized dimension to a snowflake schema:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_employee</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>    </span><span class=n>employee_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>    </span><span class=n>employee_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>    </span><span class=n>job_title</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>    </span><span class=n>department</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>    </span><span class=n>department_location</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=n>division</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>    </span><span class=n>division_head</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>    </span><span class=n>division_budget</span><span class=w> </span><span class=nb>NUMERIC</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=p>);</span>
</span></code></pre></div> <details> <summary>Solution</summary> <div class="language-sql highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_employee</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=w>    </span><span class=n>employee_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>    </span><span class=n>employee_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=w>    </span><span class=n>job_title_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>    </span><span class=n>department_key</span><span class=w> </span><span class=n>INT64</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=p>);</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_job_title</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>    </span><span class=n>job_title_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=w>    </span><span class=n>job_title</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-23-11><a id=__codelineno-23-11 name=__codelineno-23-11 href=#__codelineno-23-11></a><span class=w>    </span><span class=n>job_level</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-23-12><a id=__codelineno-23-12 name=__codelineno-23-12 href=#__codelineno-23-12></a><span class=w>    </span><span class=n>job_family</span><span class=w> </span><span class=n>STRING</span>
</span><span id=__span-23-13><a id=__codelineno-23-13 name=__codelineno-23-13 href=#__codelineno-23-13></a><span class=p>);</span>
</span><span id=__span-23-14><a id=__codelineno-23-14 name=__codelineno-23-14 href=#__codelineno-23-14></a>
</span><span id=__span-23-15><a id=__codelineno-23-15 name=__codelineno-23-15 href=#__codelineno-23-15></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_department</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-23-16><a id=__codelineno-23-16 name=__codelineno-23-16 href=#__codelineno-23-16></a><span class=w>    </span><span class=n>department_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-23-17><a id=__codelineno-23-17 name=__codelineno-23-17 href=#__codelineno-23-17></a><span class=w>    </span><span class=n>department</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-23-18><a id=__codelineno-23-18 name=__codelineno-23-18 href=#__codelineno-23-18></a><span class=w>    </span><span class=n>department_location</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-23-19><a id=__codelineno-23-19 name=__codelineno-23-19 href=#__codelineno-23-19></a><span class=w>    </span><span class=n>division_key</span><span class=w> </span><span class=n>INT64</span>
</span><span id=__span-23-20><a id=__codelineno-23-20 name=__codelineno-23-20 href=#__codelineno-23-20></a><span class=p>);</span>
</span><span id=__span-23-21><a id=__codelineno-23-21 name=__codelineno-23-21 href=#__codelineno-23-21></a>
</span><span id=__span-23-22><a id=__codelineno-23-22 name=__codelineno-23-22 href=#__codelineno-23-22></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_division</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-23-23><a id=__codelineno-23-23 name=__codelineno-23-23 href=#__codelineno-23-23></a><span class=w>    </span><span class=n>division_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-23-24><a id=__codelineno-23-24 name=__codelineno-23-24 href=#__codelineno-23-24></a><span class=w>    </span><span class=n>division</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-23-25><a id=__codelineno-23-25 name=__codelineno-23-25 href=#__codelineno-23-25></a><span class=w>    </span><span class=n>division_head</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-23-26><a id=__codelineno-23-26 name=__codelineno-23-26 href=#__codelineno-23-26></a><span class=w>    </span><span class=n>division_budget</span><span class=w> </span><span class=nb>NUMERIC</span>
</span><span id=__span-23-27><a id=__codelineno-23-27 name=__codelineno-23-27 href=#__codelineno-23-27></a><span class=p>);</span>
</span></code></pre></div> Trade-offs: - **Pros**: No redundancy, update division budget once - **Cons**: Every employee query needs 3 joins </details> <h2 id=section-4-bigquery-optimization-partitioning-and-clustering>Section 4: BigQuery Optimization - Partitioning and Clustering<a class=headerlink href=#section-4-bigquery-optimization-partitioning-and-clustering title="Permanent link">&para;</a></h2> <h3 id=key-idea_3>Key Idea<a class=headerlink href=#key-idea_3 title="Permanent link">&para;</a></h3> <p>BigQuery's serverless architecture requires different optimization strategies than traditional databases. Partitioning limits the data scanned (reduces cost), while clustering optimizes how data is organized (improves performance).</p> <h3 id=example-the-cost-problem>Example: The Cost Problem<a class=headerlink href=#example-the-cost-problem title="Permanent link">&para;</a></h3> <p>You have a table with 2 years of daily sales data (700+ days, 100M+ rows):</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=w>    </span><span class=n>sale_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>    </span><span class=n>store_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=w>    </span><span class=n>sales_amount</span><span class=w> </span><span class=nb>NUMERIC</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=p>);</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=c1>-- Typical query: Last 7 days of sales</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=k>SELECT</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>    </span><span class=n>sale_date</span><span class=p>,</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=w>    </span><span class=k>SUM</span><span class=p>(</span><span class=n>sales_amount</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>daily_sales</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=k>WHERE</span><span class=w> </span><span class=n>sale_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=k>CURRENT_DATE</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>7</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>sale_date</span><span class=p>;</span>
</span></code></pre></div> <p><strong>Without partitioning:</strong> - BigQuery scans ALL 100M rows (entire table) - Cost: ~$0.50 per query (at $5/TB) - Performance: 3-5 seconds</p> <p><strong>With date partitioning:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=w>    </span><span class=n>sale_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>    </span><span class=n>store_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=w>    </span><span class=n>sales_amount</span><span class=w> </span><span class=nb>NUMERIC</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=p>)</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>sale_date</span><span class=p>;</span>
</span></code></pre></div></p> <ul> <li>BigQuery scans only 7 days of data (~1M rows)</li> <li>Cost: ~$0.005 per query (100x cheaper!)</li> <li>Performance: 200-500ms (10x faster)</li> </ul> <h3 id=partitioning-strategies>Partitioning Strategies<a class=headerlink href=#partitioning-strategies title="Permanent link">&para;</a></h3> <p><strong>Date/Timestamp Partitioning (Most Common):</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1>-- Daily partitions</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>sale_date</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=c1>-- Monthly partitions (better for historical data)</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>DATE_TRUNC</span><span class=p>(</span><span class=n>sale_date</span><span class=p>,</span><span class=w> </span><span class=k>MONTH</span><span class=p>)</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=c1>-- Timestamp partitioning (for event data)</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=nb>DATE</span><span class=p>(</span><span class=n>event_timestamp</span><span class=p>)</span>
</span></code></pre></div></p> <p><strong>Integer Range Partitioning:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1>-- Partition by customer ID ranges</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>RANGE_BUCKET</span><span class=p>(</span><span class=n>customer_id</span><span class=p>,</span><span class=w> </span><span class=n>GENERATE_ARRAY</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=w> </span><span class=mi>100000</span><span class=p>,</span><span class=w> </span><span class=mi>1000</span><span class=p>))</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=c1>-- Creates partitions: [0-1000), [1000-2000), ...</span>
</span></code></pre></div></p> <p><strong>Ingestion-Time Partitioning:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1>-- Automatic partition based on when data is loaded</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>_PARTITIONDATE</span>
</span></code></pre></div></p> <h3 id=clustering-optimizing-within-partitions>Clustering: Optimizing Within Partitions<a class=headerlink href=#clustering-optimizing-within-partitions title="Permanent link">&para;</a></h3> <p>After partitioning by date, you might still scan millions of rows within a partition. Clustering sorts data within partitions for faster filtering.</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=w>    </span><span class=n>sale_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>    </span><span class=n>region</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=w>    </span><span class=n>sales_amount</span><span class=w> </span><span class=nb>NUMERIC</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=p>)</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>sale_date</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>region</span><span class=p>,</span><span class=w> </span><span class=n>product_id</span><span class=p>;</span>
</span></code></pre></div> <p><strong>How clustering helps:</strong></p> <p>Query filtering by region: <div class="language-sql highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>sales_amount</span><span class=p>)</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=k>WHERE</span><span class=w> </span><span class=n>sale_date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;2024-01-15&#39;</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>region</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;West&#39;</span><span class=p>;</span>
</span></code></pre></div></p> <ul> <li><strong>Partitioning</strong> limits scan to one day's data</li> <li><strong>Clustering</strong> within that day, data is sorted by region</li> <li>BigQuery skips blocks that don't contain 'West'</li> <li>Result: 10-100x less data scanned within the partition</li> </ul> <h3 id=clustering-best-practices>Clustering Best Practices<a class=headerlink href=#clustering-best-practices title="Permanent link">&para;</a></h3> <p><strong>1. Choose high-cardinality columns:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1>-- Good: Many distinct values</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>customer_id</span><span class=p>,</span><span class=w> </span><span class=n>product_id</span><span class=w>  </span><span class=c1>-- Thousands of each</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=c1>-- Bad: Few distinct values</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>is_active</span><span class=w>  </span><span class=c1>-- Only true/false</span>
</span></code></pre></div></p> <p><strong>2. Order by query filter frequency:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1>-- If you filter by region more often than product:</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>region</span><span class=p>,</span><span class=w> </span><span class=n>product_id</span><span class=w>  </span><span class=c1>-- region first</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=c1>-- Not: CLUSTER BY product_id, region</span>
</span></code></pre></div></p> <p><strong>3. Limit to 4 columns:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1>-- Good: 2-4 columns</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>region</span><span class=p>,</span><span class=w> </span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=n>store_id</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=c1>-- Diminishing returns after 4</span>
</span></code></pre></div></p> <p><strong>4. Match common WHERE clauses:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1>-- Common query:</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=k>WHERE</span><span class=w> </span><span class=n>region</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;West&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>product_category</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Electronics&#39;</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=c1>-- Matching clustering:</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>region</span><span class=p>,</span><span class=w> </span><span class=n>product_category</span>
</span></code></pre></div></p> <h3 id=cost-analysis-example>Cost Analysis Example<a class=headerlink href=#cost-analysis-example title="Permanent link">&para;</a></h3> <p><strong>Table:</strong> 1 TB of sales data (2 years, 500M rows)</p> <p><strong>Query 1: Last 30 days, no filters</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=k>WHERE</span><span class=w> </span><span class=n>sale_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=k>CURRENT_DATE</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>30</span><span class=p>;</span>
</span></code></pre></div></p> <table> <thead> <tr> <th>Configuration</th> <th>Data Scanned</th> <th>Cost</th> <th>Performance</th> </tr> </thead> <tbody> <tr> <td>No optimization</td> <td>1 TB</td> <td>$5.00</td> <td>15s</td> </tr> <tr> <td>Partitioned by date</td> <td>41 GB</td> <td>$0.21</td> <td>3s</td> </tr> <tr> <td>+ Clustered</td> <td>41 GB</td> <td>$0.21</td> <td>3s</td> </tr> </tbody> </table> <p><em>Clustering doesn't help here (no additional filters).</em></p> <p><strong>Query 2: Last 30 days, West region</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a><span class=k>WHERE</span><span class=w> </span><span class=n>sale_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=k>CURRENT_DATE</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>30</span>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>region</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;West&#39;</span><span class=p>;</span>
</span></code></pre></div></p> <table> <thead> <tr> <th>Configuration</th> <th>Data Scanned</th> <th>Cost</th> <th>Performance</th> </tr> </thead> <tbody> <tr> <td>No optimization</td> <td>1 TB</td> <td>$5.00</td> <td>18s</td> </tr> <tr> <td>Partitioned by date</td> <td>41 GB</td> <td>$0.21</td> <td>4s</td> </tr> <tr> <td>+ Clustered by region</td> <td>8 GB</td> <td>$0.04</td> <td>800ms</td> </tr> </tbody> </table> <p><em>Clustering provides 5x cost savings and 5x speed improvement!</em></p> <h3 id=partition-expiration>Partition Expiration<a class=headerlink href=#partition-expiration title="Permanent link">&para;</a></h3> <p>Automatically delete old data to save costs:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=w>    </span><span class=n>sale_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=w>    </span><span class=p>...</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=p>)</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>sale_date</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=k>OPTIONS</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>    </span><span class=n>partition_expiration_days</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>730</span><span class=w>  </span><span class=c1>-- Delete partitions older than 2 years</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=p>);</span>
</span></code></pre></div> <h3 id=why-this-matters_3>Why This Matters<a class=headerlink href=#why-this-matters_3 title="Permanent link">&para;</a></h3> <p>BigQuery pricing model: - <strong>$5 per TB scanned</strong> (on-demand) - Partitioning and clustering directly reduce costs - A poorly designed table can cost 100x more to query</p> <p>In data engineering: - <strong>Design tables for common queries</strong>: Partition and cluster based on WHERE clauses - <strong>Monitor query costs</strong>: Identify expensive queries and optimize - <strong>Balance flexibility vs. cost</strong>: More partitions = lower cost but less flexible queries</p> <p>Real-world example: - Company with 10 PB warehouse - Implemented partitioning + clustering - Reduced monthly query costs from $50k to $5k</p> <h3 id=try-it_3>Try It<a class=headerlink href=#try-it_3 title="Permanent link">&para;</a></h3> <p>You have event logs (10 TB, 1 billion rows) with this schema:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>event_logs</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=w>    </span><span class=n>event_timestamp</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>    </span><span class=n>event_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 50 distinct values</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>    </span><span class=n>device_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 10 distinct values</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=w>    </span><span class=n>country</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- 200 distinct values</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=w>    </span><span class=n>event_data</span><span class=w> </span><span class=n>JSON</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=p>);</span>
</span></code></pre></div> <p>Common queries: 1. "Events from last 7 days" 2. "Login events from last 30 days" 3. "All events for user #12345 in the last year" 4. "Events by country for last month"</p> <p>Design partition and cluster strategy.</p> <details> <summary>Solution</summary> <div class="language-sql highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>event_logs</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=w>    </span><span class=n>event_timestamp</span><span class=w> </span><span class=k>TIMESTAMP</span><span class=p>,</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>    </span><span class=n>event_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>    </span><span class=n>device_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=w>    </span><span class=n>country</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=w>    </span><span class=n>event_data</span><span class=w> </span><span class=n>JSON</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=p>)</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=nb>DATE</span><span class=p>(</span><span class=n>event_timestamp</span><span class=p>)</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>event_type</span><span class=p>,</span><span class=w> </span><span class=n>country</span><span class=p>,</span><span class=w> </span><span class=n>user_id</span><span class=p>;</span>
</span></code></pre></div> **Reasoning:** - **Partition by date**: All queries filter by time range (7 days, 30 days, 1 year) - **Cluster by event_type first**: Query 2 filters by event type, most selective - **Cluster by country second**: Query 4 filters by country - **Cluster by user_id third**: Query 3 filters by user (though high cardinality makes this less effective) **Trade-offs:** - This optimizes for queries 1, 2, and 4 - Query 3 (user-specific) will still be expensive (need to scan many partitions) - Consider separate table or partition by user_id if query 3 is critical </details> <h2 id=section-5-slowly-changing-dimensions-scd-type-2>Section 5: Slowly Changing Dimensions (SCD) Type 2<a class=headerlink href=#section-5-slowly-changing-dimensions-scd-type-2 title="Permanent link">&para;</a></h2> <h3 id=key-idea_4>Key Idea<a class=headerlink href=#key-idea_4 title="Permanent link">&para;</a></h3> <p>Dimension attributes change over time. SCD Type 2 tracks historical changes by creating new rows with effective dates, enabling time-travel queries and historical accuracy.</p> <h3 id=example-customer-address-changes>Example: Customer Address Changes<a class=headerlink href=#example-customer-address-changes title="Permanent link">&para;</a></h3> <p>Your customer moves. How do you handle this in your warehouse?</p> <p><strong>Option 1: Overwrite (SCD Type 1) - No History</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=k>UPDATE</span><span class=w> </span><span class=n>dim_customer</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=k>SET</span><span class=w> </span><span class=n>address</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;456 New St&#39;</span><span class=p>,</span>
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a><span class=w>    </span><span class=n>city</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;Seattle&#39;</span><span class=p>,</span>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=w>    </span><span class=k>state</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;WA&#39;</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;C123&#39;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Problem:</strong> Historical sales now show the customer always lived in Seattle, even for orders placed when they lived in New York. Your "sales by region" report is now wrong for historical data.</p> <p><strong>Option 2: Add New Row (SCD Type 2) - Full History</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1>-- Original row (now expired)</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=n>customer_key</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>name</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>address</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=n>city</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=k>state</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>effective_date</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>expiration_date</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>is_current</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=mi>1001</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>C123</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>Alice</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>123</span><span class=w> </span><span class=k>Old</span><span class=w> </span><span class=n>St</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=k>New</span><span class=w> </span><span class=n>York</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>NY</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>2020</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>01</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>15</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>false</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=c1>-- New row (current)</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=mi>1005</span><span class=w>         </span><span class=o>|</span><span class=w> </span><span class=n>C123</span><span class=w>        </span><span class=o>|</span><span class=w> </span><span class=n>Alice</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>456</span><span class=w> </span><span class=k>New</span><span class=w> </span><span class=n>St</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>Seattle</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>WA</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=mi>2024</span><span class=o>-</span><span class=mi>01</span><span class=o>-</span><span class=mi>16</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=mi>9999</span><span class=o>-</span><span class=mi>12</span><span class=o>-</span><span class=mi>31</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>true</span>
</span></code></pre></div></p> <p>Now historical sales (before 2024-01-16) correctly show New York, while new sales show Seattle.</p> <h3 id=implementing-scd-type-2>Implementing SCD Type 2<a class=headerlink href=#implementing-scd-type-2 title="Permanent link">&para;</a></h3> <p><strong>Schema Design:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=w>    </span><span class=n>customer_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Surrogate key (changes for each version)</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Natural key (same across versions)</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=w>    </span><span class=n>customer_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=w>    </span><span class=n>email</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=w>    </span><span class=n>address</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=w>    </span><span class=n>city</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a><span class=w>    </span><span class=k>state</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a><span class=w>    </span><span class=n>customer_segment</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=w>    </span><span class=c1>-- SCD Type 2 columns</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a><span class=w>    </span><span class=n>effective_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span><span class=w>  </span><span class=c1>-- When this version became active</span>
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a><span class=w>    </span><span class=n>expiration_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span><span class=w>  </span><span class=c1>-- When this version expired (9999-12-31 for current)</span>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=w>    </span><span class=n>is_current</span><span class=w> </span><span class=n>BOOL</span><span class=w>  </span><span class=c1>-- TRUE for current version, FALSE for historical</span>
</span><span id=__span-42-14><a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a><span class=p>);</span>
</span></code></pre></div></p> <p><strong>Initial Load:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=k>VALUES</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;C123&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Alice&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;alice@email.com&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;123 Old St&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;New York&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;NY&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Premium&#39;</span><span class=p>,</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=w> </span><span class=s1>&#39;2020-01-01&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;9999-12-31&#39;</span><span class=p>,</span><span class=w> </span><span class=k>TRUE</span><span class=p>);</span>
</span></code></pre></div></p> <p><strong>Update Process (Customer Moves):</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1>-- Step 1: Expire the old row</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=k>UPDATE</span><span class=w> </span><span class=n>dim_customer</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=k>SET</span><span class=w> </span><span class=n>expiration_date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;2024-01-15&#39;</span><span class=p>,</span>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=w>    </span><span class=n>is_current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>FALSE</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;C123&#39;</span>
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>is_current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>TRUE</span><span class=p>;</span>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a><span class=c1>-- Step 2: Insert new row</span>
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=k>VALUES</span>
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;C123&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Alice&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;alice@email.com&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;456 New St&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Seattle&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;WA&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;Premium&#39;</span><span class=p>,</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a><span class=w> </span><span class=s1>&#39;2024-01-16&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;9999-12-31&#39;</span><span class=p>,</span><span class=w> </span><span class=k>TRUE</span><span class=p>);</span>
</span></code></pre></div></p> <h3 id=querying-scd-type-2-tables>Querying SCD Type 2 Tables<a class=headerlink href=#querying-scd-type-2-tables title="Permanent link">&para;</a></h3> <p><strong>Current State (Most Common):</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=c1>-- Get current customer info</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=k>FROM</span><span class=w> </span><span class=n>dim_customer</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;C123&#39;</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>is_current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>TRUE</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Historical State (Time Travel):</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=c1>-- What was Alice&#39;s address on Jan 10, 2024?</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=k>FROM</span><span class=w> </span><span class=n>dim_customer</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;C123&#39;</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2024-01-10&#39;</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=n>effective_date</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>expiration_date</span><span class=p>;</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=c1>-- Returns: 123 Old St, New York, NY</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=c1>-- What was Alice&#39;s address on Jan 20, 2024?</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=k>FROM</span><span class=w> </span><span class=n>dim_customer</span>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=k>WHERE</span><span class=w> </span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;C123&#39;</span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2024-01-20&#39;</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=n>effective_date</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>expiration_date</span><span class=p>;</span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=c1>-- Returns: 456 New St, Seattle, WA</span>
</span></code></pre></div></p> <p><strong>Historical Fact Joins:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=c1>-- Sales report with correct historical customer data</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=k>SELECT</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=w>    </span><span class=n>f</span><span class=p>.</span><span class=n>sale_date</span><span class=p>,</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=w>    </span><span class=k>c</span><span class=p>.</span><span class=n>customer_name</span><span class=p>,</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=w>    </span><span class=k>c</span><span class=p>.</span><span class=n>city</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>customer_city_at_time_of_sale</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Correct historical city</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=w>    </span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=k>c</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=w>    </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>customer_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>customer_key</span><span class=w>  </span><span class=c1>-- Join on surrogate key</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=k>WHERE</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>sale_date</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=s1>&#39;2024-01-01&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2024-01-31&#39;</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Note:</strong> The fact table stores <code>customer_key</code> (surrogate key), not <code>customer_id</code> (natural key). This is crucial for SCD Type 2 to work!</p> <h3 id=which-attributes-should-be-scd-type-2>Which Attributes Should Be SCD Type 2?<a class=headerlink href=#which-attributes-should-be-scd-type-2 title="Permanent link">&para;</a></h3> <p><strong>Good candidates:</strong> - Address, city, state (affects regional analysis) - Customer segment (affects segmentation analysis) - Product category (affects category trends) - Price (affects historical revenue accuracy)</p> <p><strong>Bad candidates:</strong> - Last login date (changes too frequently) - Transaction count (updated constantly) - Profile photo URL (not used in analytics)</p> <p><strong>Mixed approach:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=w>    </span><span class=n>customer_key</span><span class=w> </span><span class=n>INT64</span><span class=p>,</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>    </span><span class=c1>-- SCD Type 2 attributes</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=w>    </span><span class=n>address</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=w>    </span><span class=n>city</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>    </span><span class=k>state</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=w>    </span><span class=n>customer_segment</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=w>    </span><span class=n>effective_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=w>    </span><span class=n>expiration_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-48-11><a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a><span class=w>    </span><span class=n>is_current</span><span class=w> </span><span class=n>BOOL</span><span class=p>,</span>
</span><span id=__span-48-12><a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=w>    </span><span class=c1>-- SCD Type 1 attributes (just overwrite)</span>
</span><span id=__span-48-13><a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=w>    </span><span class=n>email</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Changes infrequently, history not needed</span>
</span><span id=__span-48-14><a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class=w>    </span><span class=n>phone</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-48-15><a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class=w>    </span><span class=n>last_login_date</span><span class=w> </span><span class=nb>DATE</span><span class=w>  </span><span class=c1>-- Too frequent to track</span>
</span><span id=__span-48-16><a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a><span class=p>);</span>
</span></code></pre></div></p> <h3 id=etl-pipeline-for-scd-type-2>ETL Pipeline for SCD Type 2<a class=headerlink href=#etl-pipeline-for-scd-type-2 title="Permanent link">&para;</a></h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=k>def</span><span class=w> </span><span class=nf>update_customer_dimension</span><span class=p>(</span><span class=n>new_data</span><span class=p>):</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=sd>    ETL logic for SCD Type 2 customer dimension.</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a>    <span class=k>for</span> <span class=n>customer</span> <span class=ow>in</span> <span class=n>new_data</span><span class=p>:</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a>        <span class=c1># Get current record</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a>        <span class=n>current</span> <span class=o>=</span> <span class=n>get_current_record</span><span class=p>(</span><span class=n>customer</span><span class=p>[</span><span class=s1>&#39;customer_id&#39;</span><span class=p>])</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>        <span class=k>if</span> <span class=n>current</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a>            <span class=c1># New customer - insert</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a>            <span class=n>insert_customer</span><span class=p>(</span><span class=n>customer</span><span class=p>,</span> <span class=n>is_current</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a>        <span class=k>else</span><span class=p>:</span>
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a>            <span class=c1># Existing customer - check if attributes changed</span>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a>            <span class=k>if</span> <span class=n>customer_changed</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=n>customer</span><span class=p>):</span>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a>                <span class=c1># Expire old record</span>
</span><span id=__span-49-17><a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a>                <span class=n>expire_record</span><span class=p>(</span><span class=n>current</span><span class=p>[</span><span class=s1>&#39;customer_key&#39;</span><span class=p>])</span>
</span><span id=__span-49-18><a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a>
</span><span id=__span-49-19><a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a>                <span class=c1># Insert new record</span>
</span><span id=__span-49-20><a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a>                <span class=n>insert_customer</span><span class=p>(</span><span class=n>customer</span><span class=p>,</span> <span class=n>is_current</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span><span id=__span-49-21><a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a>
</span><span id=__span-49-22><a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a>            <span class=k>else</span><span class=p>:</span>
</span><span id=__span-49-23><a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a>                <span class=c1># No change - optionally update Type 1 attributes</span>
</span><span id=__span-49-24><a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a>                <span class=n>update_non_tracked_attributes</span><span class=p>(</span><span class=n>current</span><span class=p>[</span><span class=s1>&#39;customer_key&#39;</span><span class=p>],</span> <span class=n>customer</span><span class=p>)</span>
</span><span id=__span-49-25><a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a>
</span><span id=__span-49-26><a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=k>def</span><span class=w> </span><span class=nf>customer_changed</span><span class=p>(</span><span class=n>current</span><span class=p>,</span> <span class=n>new</span><span class=p>):</span>
</span><span id=__span-49-27><a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-49-28><a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=sd>    Check if Type 2 attributes have changed.</span>
</span><span id=__span-49-29><a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class=sd>    &quot;&quot;&quot;</span>
</span><span id=__span-49-30><a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a>    <span class=n>type2_attributes</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;address&#39;</span><span class=p>,</span> <span class=s1>&#39;city&#39;</span><span class=p>,</span> <span class=s1>&#39;state&#39;</span><span class=p>,</span> <span class=s1>&#39;customer_segment&#39;</span><span class=p>]</span>
</span><span id=__span-49-31><a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a>    <span class=k>for</span> <span class=n>attr</span> <span class=ow>in</span> <span class=n>type2_attributes</span><span class=p>:</span>
</span><span id=__span-49-32><a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a>        <span class=k>if</span> <span class=n>current</span><span class=p>[</span><span class=n>attr</span><span class=p>]</span> <span class=o>!=</span> <span class=n>new</span><span class=p>[</span><span class=n>attr</span><span class=p>]:</span>
</span><span id=__span-49-33><a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a>            <span class=k>return</span> <span class=kc>True</span>
</span><span id=__span-49-34><a id=__codelineno-49-34 name=__codelineno-49-34 href=#__codelineno-49-34></a>    <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div> <h3 id=why-this-matters_4>Why This Matters<a class=headerlink href=#why-this-matters_4 title="Permanent link">&para;</a></h3> <p>SCD Type 2 enables: - <strong>Historical accuracy</strong>: Reports reflect data as it was at the time - <strong>Trend analysis</strong>: Track how customers/products change over time - <strong>Compliance</strong>: Audit trails for regulatory requirements - <strong>Point-in-time queries</strong>: "What did our customer base look like last year?"</p> <p>In data engineering: - <strong>ETL complexity increases</strong>: Need to detect changes and manage versions - <strong>Storage increases</strong>: Multiple versions of same entity - <strong>Query patterns change</strong>: Must join on surrogate keys, not natural keys</p> <p>Real-world example: E-commerce - Product price changes (SCD Type 2): Historical orders show correct price - Customer upgrades to Premium (SCD Type 2): Analyze premium customers over time - Product name typo fix (SCD Type 1): Just overwrite, history doesn't matter</p> <h3 id=try-it_4>Try It<a class=headerlink href=#try-it_4 title="Permanent link">&para;</a></h3> <p>You have a product dimension. Products can change category and price. Design an SCD Type 2 solution.</p> <p>Requirements: - Track category changes (important for trend analysis) - Track price changes (important for revenue accuracy) - Don't track description changes (just overwrite)</p> <details> <summary>Solution</summary> <div class="language-sql highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a><span class=w>    </span><span class=n>product_key</span><span class=w> </span><span class=n>INT64</span><span class=w> </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=p>,</span>
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=w>    </span><span class=n>product_name</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=w>    </span><span class=c1>-- SCD Type 2 tracked attributes</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a><span class=w>    </span><span class=n>category</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=w>    </span><span class=n>price</span><span class=w> </span><span class=nb>NUMERIC</span><span class=p>,</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a><span class=w>    </span><span class=n>effective_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a><span class=w>    </span><span class=n>expiration_date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=w>    </span><span class=n>is_current</span><span class=w> </span><span class=n>BOOL</span><span class=p>,</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a><span class=w>    </span><span class=c1>-- SCD Type 1 attributes (overwrite)</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a><span class=w>    </span><span class=n>description</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=w>    </span><span class=n>image_url</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a><span class=w>    </span><span class=n>last_updated</span><span class=w> </span><span class=k>TIMESTAMP</span>
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=p>);</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a>
</span><span id=__span-50-17><a id=__codelineno-50-17 name=__codelineno-50-17 href=#__codelineno-50-17></a><span class=c1>-- Example: Price change from $29.99 to $34.99 on Jan 15, 2024</span>
</span><span id=__span-50-18><a id=__codelineno-50-18 name=__codelineno-50-18 href=#__codelineno-50-18></a>
</span><span id=__span-50-19><a id=__codelineno-50-19 name=__codelineno-50-19 href=#__codelineno-50-19></a><span class=c1>-- Before (current row):</span>
</span><span id=__span-50-20><a id=__codelineno-50-20 name=__codelineno-50-20 href=#__codelineno-50-20></a><span class=c1>-- product_key | product_id | name         | category | price | effective  | expiration | is_current</span>
</span><span id=__span-50-21><a id=__codelineno-50-21 name=__codelineno-50-21 href=#__codelineno-50-21></a><span class=c1>-- 101         | P001       | Python Book  | Books    | 29.99 | 2023-01-01 | 9999-12-31 | true</span>
</span><span id=__span-50-22><a id=__codelineno-50-22 name=__codelineno-50-22 href=#__codelineno-50-22></a>
</span><span id=__span-50-23><a id=__codelineno-50-23 name=__codelineno-50-23 href=#__codelineno-50-23></a><span class=c1>-- After (two rows):</span>
</span><span id=__span-50-24><a id=__codelineno-50-24 name=__codelineno-50-24 href=#__codelineno-50-24></a><span class=c1>-- 101         | P001       | Python Book  | Books    | 29.99 | 2023-01-01 | 2024-01-14 | false</span>
</span><span id=__span-50-25><a id=__codelineno-50-25 name=__codelineno-50-25 href=#__codelineno-50-25></a><span class=c1>-- 105         | P001       | Python Book  | Books    | 34.99 | 2024-01-15 | 9999-12-31 | true</span>
</span><span id=__span-50-26><a id=__codelineno-50-26 name=__codelineno-50-26 href=#__codelineno-50-26></a>
</span><span id=__span-50-27><a id=__codelineno-50-27 name=__codelineno-50-27 href=#__codelineno-50-27></a><span class=c1>-- Historical query: Sales before price change</span>
</span><span id=__span-50-28><a id=__codelineno-50-28 name=__codelineno-50-28 href=#__codelineno-50-28></a><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span><span class=p>)</span>
</span><span id=__span-50-29><a id=__codelineno-50-29 name=__codelineno-50-29 href=#__codelineno-50-29></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-50-30><a id=__codelineno-50-30 name=__codelineno-50-30 href=#__codelineno-50-30></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>product_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_key</span>
</span><span id=__span-50-31><a id=__codelineno-50-31 name=__codelineno-50-31 href=#__codelineno-50-31></a><span class=k>WHERE</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;P001&#39;</span>
</span><span id=__span-50-32><a id=__codelineno-50-32 name=__codelineno-50-32 href=#__codelineno-50-32></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>sale_date</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=s1>&#39;2024-01-15&#39;</span><span class=p>;</span>
</span><span id=__span-50-33><a id=__codelineno-50-33 name=__codelineno-50-33 href=#__codelineno-50-33></a><span class=c1>-- Uses product_key 101 (old price $29.99)</span>
</span><span id=__span-50-34><a id=__codelineno-50-34 name=__codelineno-50-34 href=#__codelineno-50-34></a>
</span><span id=__span-50-35><a id=__codelineno-50-35 name=__codelineno-50-35 href=#__codelineno-50-35></a><span class=c1>-- Historical query: Sales after price change</span>
</span><span id=__span-50-36><a id=__codelineno-50-36 name=__codelineno-50-36 href=#__codelineno-50-36></a><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>f</span><span class=p>.</span><span class=n>sales_amount</span><span class=p>)</span>
</span><span id=__span-50-37><a id=__codelineno-50-37 name=__codelineno-50-37 href=#__codelineno-50-37></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-50-38><a id=__codelineno-50-38 name=__codelineno-50-38 href=#__codelineno-50-38></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_product</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>product_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_key</span>
</span><span id=__span-50-39><a id=__codelineno-50-39 name=__codelineno-50-39 href=#__codelineno-50-39></a><span class=k>WHERE</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;P001&#39;</span>
</span><span id=__span-50-40><a id=__codelineno-50-40 name=__codelineno-50-40 href=#__codelineno-50-40></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>sale_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=s1>&#39;2024-01-15&#39;</span><span class=p>;</span>
</span><span id=__span-50-41><a id=__codelineno-50-41 name=__codelineno-50-41 href=#__codelineno-50-41></a><span class=c1>-- Uses product_key 105 (new price $34.99)</span>
</span></code></pre></div> </details> <h2 id=common-pitfalls>Common Pitfalls<a class=headerlink href=#common-pitfalls title="Permanent link">&para;</a></h2> <h3 id=1-querying-fact-with-natural-key-instead-of-surrogate-key>1. Querying Fact with Natural Key Instead of Surrogate Key<a class=headerlink href=#1-querying-fact-with-natural-key-instead-of-surrogate-key title="Permanent link">&para;</a></h3> <p><strong>Problem:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=c1>-- This loses historical accuracy!</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>sales_amount</span><span class=p>)</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>customer_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>customer_id</span><span class=w>  </span><span class=c1>-- Natural key</span>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=k>WHERE</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>is_current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>TRUE</span><span class=p>;</span>
</span></code></pre></div></p> <p><strong>Fix:</strong> Always join on surrogate keys in fact tables: <div class="language-sql highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=k>SELECT</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>sales_amount</span><span class=p>)</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=n>f</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=k>JOIN</span><span class=w> </span><span class=n>dim_customer</span><span class=w> </span><span class=k>c</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>f</span><span class=p>.</span><span class=n>customer_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>customer_key</span><span class=p>;</span><span class=w>  </span><span class=c1>-- Surrogate key</span>
</span></code></pre></div></p> <h3 id=2-not-choosing-partition-key-based-on-query-patterns>2. Not Choosing Partition Key Based on Query Patterns<a class=headerlink href=#2-not-choosing-partition-key-based-on-query-patterns title="Permanent link">&para;</a></h3> <p><strong>Problem:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=c1>-- Partitioned by customer_id, but you query by date</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>customer_id</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>fact_sales</span>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=k>WHERE</span><span class=w> </span><span class=n>sale_date</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=s1>&#39;2024-01-01&#39;</span><span class=p>;</span><span class=w>  </span><span class=c1>-- Full scan!</span>
</span></code></pre></div></p> <p><strong>Fix:</strong> Partition by the column you filter most often (usually date).</p> <h3 id=3-over-clustering>3. Over-Clustering<a class=headerlink href=#3-over-clustering title="Permanent link">&para;</a></h3> <p><strong>Problem:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=c1>-- Too many clustering columns (diminishing returns)</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a><span class=k>CLUSTER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>col1</span><span class=p>,</span><span class=w> </span><span class=n>col2</span><span class=p>,</span><span class=w> </span><span class=n>col3</span><span class=p>,</span><span class=w> </span><span class=n>col4</span><span class=p>,</span><span class=w> </span><span class=n>col5</span><span class=p>,</span><span class=w> </span><span class=n>col6</span><span class=p>,</span><span class=w> </span><span class=n>col7</span>
</span></code></pre></div></p> <p><strong>Fix:</strong> Limit to 2-4 high-cardinality columns that match WHERE clauses.</p> <h3 id=4-not-handling-dimension-load-order>4. Not Handling Dimension Load Order<a class=headerlink href=#4-not-handling-dimension-load-order title="Permanent link">&para;</a></h3> <p><strong>Problem:</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=c1>-- Load facts before dimensions</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>fact_sales</span><span class=w> </span><span class=p>(...,</span><span class=w> </span><span class=n>product_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>999</span><span class=p>);</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=c1>-- Product 999 doesn&#39;t exist in dim_product yet!</span>
</span></code></pre></div></p> <p><strong>Fix:</strong> Always load dimensions before facts in your ETL pipeline.</p> <h2 id=reflection-questions>Reflection Questions<a class=headerlink href=#reflection-questions title="Permanent link">&para;</a></h2> <ol> <li><strong>When would you choose snowflake over star schema?</strong></li> </ol> <p>Consider: - How complex are your dimension hierarchies? - How often do hierarchy definitions change (e.g., org restructuring)? - Are storage costs a major concern? - How comfortable are your analysts with complex SQL?</p> <ol> <li><strong>A BigQuery table costs $100/day to query. How would you optimize it?</strong></li> </ol> <p>Steps: - Analyze query logs to find expensive queries - Check if table is partitioned (add partition if not) - Check if queries filter on high-cardinality columns (add clustering) - Consider materialized views for repeated aggregations - Educate users on query best practices (avoid SELECT *)</p> <ol> <li><strong>You need to track product price changes historically. Would you use SCD Type 1, Type 2, or a separate price history table?</strong></li> </ol> <p>SCD Type 1: If you only care about current price, no historical analysis SCD Type 2: If you need correct historical revenue in reports Separate table: If prices change very frequently (e.g., dynamic pricing)</p> <ol> <li><strong>Your star schema has 20 dimensions. Is this a problem?</strong></li> </ol> <p>Consider: - How many dimensions does a typical query join? (If 3-4, it's fine) - Are some dimensions rarely used? (Consider removing or separating) - Are some dimensions really attributes of other dimensions? (Snowflake candidate) - Does query performance meet requirements? (If yes, don't over-optimize)</p> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <ul> <li> <p><strong>OLTP and OLAP serve different purposes</strong>: Transactional systems use normalized schemas for data integrity, while analytical systems use denormalized schemas for query performance.</p> </li> <li> <p><strong>Star schema is the foundation</strong> of dimensional modeling, with a central fact table surrounded by dimension tables. It provides simplicity, performance, and flexibility for analytics.</p> </li> <li> <p><strong>Snowflake schema normalizes dimensions</strong>, reducing redundancy at the cost of query complexity. Use it for complex hierarchies or storage constraints, but default to star schema for most cases.</p> </li> <li> <p><strong>BigQuery partitioning reduces costs</strong> by limiting data scanned, while <strong>clustering improves performance</strong> by organizing data within partitions. Design based on common query patterns.</p> </li> <li> <p><strong>SCD Type 2 tracks historical changes</strong> by creating new dimension rows with effective dates. Essential for accurate historical reporting but increases ETL complexity and storage.</p> </li> <li> <p><strong>Surrogate keys enable SCD Type 2</strong> and decouple the warehouse from source system changes. Always use surrogate keys in dimension tables.</p> </li> </ul> <h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <p>Congratulations! You've completed the foundations of data engineering (Weeks 1-4). You now understand:</p> <ul> <li>Python and SQL for data processing</li> <li>Git and Docker for collaboration and deployment</li> <li>Database design and normalization</li> <li>Data warehouse modeling and optimization</li> </ul> <p>In Weeks 5-8, you'll build on these foundations with: - <strong>ETL pipeline development</strong> with Airflow - <strong>Data quality frameworks</strong> and testing - <strong>Streaming data</strong> with Kafka - <strong>Cloud data platforms</strong> (Snowflake, Databricks)</p> <p>The concepts from these first four chapters—scalable code patterns, collaborative workflows, intentional schema design, and optimization strategies—will be essential as you tackle more complex data engineering challenges. You're ready to build production pipelines that scale!</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2026 Data Engineering Bootcamp </div> </div> <div class=md-social> <a href=https://github.com/yourusername/data-engineering-course target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/yourprofile target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>