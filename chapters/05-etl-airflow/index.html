<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Comprehensive data engineering course for software engineers transitioning to data roles"><meta name=author content="Data Engineering Bootcamp Team"><link href=https://yourusername.github.io/data-engineering-course/chapters/05-etl-airflow/ rel=canonical><link href=../04-data-warehousing/quiz/ rel=prev><link href=quiz/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Content - Data Engineering Bootcamp</title><link rel=stylesheet href=../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#chapter-5-etlelt-apache-airflow class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Data Engineering Bootcamp" class="md-header__button md-logo" aria-label="Data Engineering Bootcamp" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Data Engineering Bootcamp </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Content </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/yourusername/data-engineering-course title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> data-engineering-course </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../course-description/ class=md-tabs__link> Course Description </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../01-python-sql-foundations/ class=md-tabs__link> Chapters </a> </li> <li class=md-tabs__item> <a href=../../sims/sql-execution-plan/spec/ class=md-tabs__link> Interactive MicroSims </a> </li> <li class=md-tabs__item> <a href=../../glossary/ class=md-tabs__link> Resources </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Data Engineering Bootcamp" class="md-nav__button md-logo" aria-label="Data Engineering Bootcamp" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Data Engineering Bootcamp </label> <div class=md-nav__source> <a href=https://github.com/yourusername/data-engineering-course title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> data-engineering-course </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../course-description/ class=md-nav__link> <span class=md-ellipsis> Course Description </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Chapters </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Chapters </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex> <span class=md-ellipsis> Chapter 1 - Python & SQL Foundations </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Chapter 1 - Python & SQL Foundations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../01-python-sql-foundations/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> <li class=md-nav__item> <a href=../01-python-sql-foundations/quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Chapter 2 - Git & Docker </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Chapter 2 - Git & Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../02-git-docker/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> <li class=md-nav__item> <a href=../02-git-docker/quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> Chapter 3 - Database Modeling </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Chapter 3 - Database Modeling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../03-database-modeling/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> <li class=md-nav__item> <a href=../03-database-modeling/quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex> <span class=md-ellipsis> Chapter 4 - Data Warehousing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Chapter 4 - Data Warehousing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../04-data-warehousing/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> <li class=md-nav__item> <a href=../04-data-warehousing/quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5 checked> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex> <span class=md-ellipsis> Chapter 5 - ETL/ELT & Apache Airflow </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=true> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Chapter 5 - ETL/ELT & Apache Airflow </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Content </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Content </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#learning-objectives class=md-nav__link> <span class=md-ellipsis> Learning Objectives </span> </a> </li> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#section-1-etl-vs-elt-the-great-debate-i-learned-the-hard-way class=md-nav__link> <span class=md-ellipsis> Section 1: ETL vs ELT - The Great Debate I Learned the Hard Way </span> </a> <nav class=md-nav aria-label="Section 1: ETL vs ELT - The Great Debate I Learned the Hard Way"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-day-i-processed-500gb-of-data-in-python-i-shouldnt-have class=md-nav__link> <span class=md-ellipsis> The Day I Processed 500GB Of Data In Python (I Shouldn't Have) </span> </a> </li> <li class=md-nav__item> <a href=#heres-what-i-wish-id-known-transform-where-the-data-lives class=md-nav__link> <span class=md-ellipsis> Here's What I Wish I'd Known: Transform Where the Data Lives </span> </a> </li> <li class=md-nav__item> <a href=#my-hard-learned-rule class=md-nav__link> <span class=md-ellipsis> My Hard-Learned Rule </span> </a> </li> <li class=md-nav__item> <a href=#scars-ive-earned-etlelt-edition class=md-nav__link> <span class=md-ellipsis> Scars I've Earned: ETL/ELT Edition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-2-apache-airflow-the-orchestrator-i-didnt-know-i-needed class=md-nav__link> <span class=md-ellipsis> Section 2: Apache Airflow - The Orchestrator I Didn't Know I Needed </span> </a> <nav class=md-nav aria-label="Section 2: Apache Airflow - The Orchestrator I Didn't Know I Needed"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-cron-job-that-became-sentient-and-not-in-a-good-way class=md-nav__link> <span class=md-ellipsis> The Cron Job That Became Sentient (And Not In A Good Way) </span> </a> </li> <li class=md-nav__item> <a href=#heres-what-i-wish-id-known-orchestrators-are-your-new-best-friend class=md-nav__link> <span class=md-ellipsis> Here's What I Wish I'd Known: Orchestrators Are Your New Best Friend </span> </a> </li> <li class=md-nav__item> <a href=#example-converting-cron-chaos-to-airflow-clarity class=md-nav__link> <span class=md-ellipsis> Example: Converting Cron Chaos to Airflow Clarity </span> </a> </li> <li class=md-nav__item> <a href=#why-this-is-better-so-much-better class=md-nav__link> <span class=md-ellipsis> Why This Is Better (So Much Better) </span> </a> </li> <li class=md-nav__item> <a href=#scars-ive-earned-airflow-edition class=md-nav__link> <span class=md-ellipsis> Scars I've Earned: Airflow Edition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-3-idempotency-the-property-that-saves-careers class=md-nav__link> <span class=md-ellipsis> Section 3: Idempotency - The Property That Saves Careers </span> </a> <nav class=md-nav aria-label="Section 3: Idempotency - The Property That Saves Careers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-append-that-appended-twice-million-times class=md-nav__link> <span class=md-ellipsis> The Append That Appended Twice (Million Times) </span> </a> </li> <li class=md-nav__item> <a href=#heres-what-i-wish-id-known-idempotency-is-non-negotiable class=md-nav__link> <span class=md-ellipsis> Here's What I Wish I'd Known: Idempotency Is Non-Negotiable </span> </a> </li> <li class=md-nav__item> <a href=#patterns-for-idempotent-pipelines class=md-nav__link> <span class=md-ellipsis> Patterns for Idempotent Pipelines </span> </a> </li> <li class=md-nav__item> <a href=#my-idempotency-checklist class=md-nav__link> <span class=md-ellipsis> My Idempotency Checklist </span> </a> </li> <li class=md-nav__item> <a href=#scars-ive-earned-idempotency-edition class=md-nav__link> <span class=md-ellipsis> Scars I've Earned: Idempotency Edition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-4-monitoring-alerting-because-hope-is-not-a-strategy class=md-nav__link> <span class=md-ellipsis> Section 4: Monitoring &amp; Alerting - Because Hope Is Not A Strategy </span> </a> <nav class=md-nav aria-label="Section 4: Monitoring & Alerting - Because Hope Is Not A Strategy"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-pipeline-that-failed-for-three-days-before-anyone-noticed class=md-nav__link> <span class=md-ellipsis> The Pipeline That Failed For Three Days (Before Anyone Noticed) </span> </a> </li> <li class=md-nav__item> <a href=#heres-what-i-wish-id-known-monitor-everything-that-matters class=md-nav__link> <span class=md-ellipsis> Here's What I Wish I'd Known: Monitor Everything That Matters </span> </a> </li> <li class=md-nav__item> <a href=#my-monitoring-pyramid class=md-nav__link> <span class=md-ellipsis> My Monitoring Pyramid </span> </a> </li> <li class=md-nav__item> <a href=#scars-ive-earned-monitoring-edition class=md-nav__link> <span class=md-ellipsis> Scars I've Earned: Monitoring Edition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> <li class=md-nav__item> <a href=#reflection-questions class=md-nav__link> <span class=md-ellipsis> Reflection Questions </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=quiz/ class=md-nav__link> <span class=md-ellipsis> Quiz </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex> <span class=md-ellipsis> Chapter 6 - Data Quality & Error Handling </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Chapter 6 - Data Quality & Error Handling </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../06-data-quality/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7 id=__nav_3_7_label tabindex> <span class=md-ellipsis> Chapter 7 - Apache Spark & PySpark </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Chapter 7 - Apache Spark & PySpark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../07-spark-pyspark/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex> <span class=md-ellipsis> Chapter 8 - Kafka & Streaming Data </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Chapter 8 - Kafka & Streaming Data </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../08-kafka-streaming/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9 id=__nav_3_9_label tabindex> <span class=md-ellipsis> Chapter 9 - Cloud Data Engineering (GCP) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Chapter 9 - Cloud Data Engineering (GCP) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../09-cloud-gcp/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_10> <label class=md-nav__link for=__nav_3_10 id=__nav_3_10_label tabindex> <span class=md-ellipsis> Chapter 10 - Infrastructure as Code & CI/CD </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=false> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Chapter 10 - Infrastructure as Code & CI/CD </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../10-iac-cicd/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_11> <label class=md-nav__link for=__nav_3_11 id=__nav_3_11_label tabindex> <span class=md-ellipsis> Chapter 11 - Capstone Project (Design) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_11_label aria-expanded=false> <label class=md-nav__title for=__nav_3_11> <span class="md-nav__icon md-icon"></span> Chapter 11 - Capstone Project (Design) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../11-capstone-part1/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_12> <label class=md-nav__link for=__nav_3_12 id=__nav_3_12_label tabindex> <span class=md-ellipsis> Chapter 12 - Capstone Project (Implementation) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_12_label aria-expanded=false> <label class=md-nav__title for=__nav_3_12> <span class="md-nav__icon md-icon"></span> Chapter 12 - Capstone Project (Implementation) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../12-capstone-part2/ class=md-nav__link> <span class=md-ellipsis> Content </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Interactive MicroSims </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Interactive MicroSims </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sims/sql-execution-plan/spec/ class=md-nav__link> <span class=md-ellipsis> SQL Execution Plan Visualizer </span> </a> </li> <li class=md-nav__item> <a href=../../sims/git-merge-rebase/spec/ class=md-nav__link> <span class=md-ellipsis> Git Merge vs Rebase </span> </a> </li> <li class=md-nav__item> <a href=../../sims/star-vs-snowflake/spec/ class=md-nav__link> <span class=md-ellipsis> Star vs Snowflake Schema </span> </a> </li> <li class=md-nav__item> <a href=../../sims/normalization-journey/spec/ class=md-nav__link> <span class=md-ellipsis> Database Normalization </span> </a> </li> <li class=md-nav__item> <a href=../../sims/bigquery-partitioning/spec/ class=md-nav__link> <span class=md-ellipsis> BigQuery Partitioning </span> </a> </li> <li class=md-nav__item> <a href=../../sims/scd-timeline/spec/ class=md-nav__link> <span class=md-ellipsis> Slowly Changing Dimensions </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Resources </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../glossary/ class=md-nav__link> <span class=md-ellipsis> Glossary </span> </a> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> <span class=md-ellipsis> FAQ </span> </a> </li> <li class=md-nav__item> <a href=../../learning-graph/learning-graph.json class=md-nav__link> <span class=md-ellipsis> Learning Graph </span> </a> </li> <li class=md-nav__item> <a href=../INDEX/ class=md-nav__link> <span class=md-ellipsis> Quiz Guide </span> </a> </li> <li class=md-nav__item> <a href=../INSTRUCTOR_GUIDE/ class=md-nav__link> <span class=md-ellipsis> Instructor Guide </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#learning-objectives class=md-nav__link> <span class=md-ellipsis> Learning Objectives </span> </a> </li> <li class=md-nav__item> <a href=#introduction class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=#section-1-etl-vs-elt-the-great-debate-i-learned-the-hard-way class=md-nav__link> <span class=md-ellipsis> Section 1: ETL vs ELT - The Great Debate I Learned the Hard Way </span> </a> <nav class=md-nav aria-label="Section 1: ETL vs ELT - The Great Debate I Learned the Hard Way"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-day-i-processed-500gb-of-data-in-python-i-shouldnt-have class=md-nav__link> <span class=md-ellipsis> The Day I Processed 500GB Of Data In Python (I Shouldn't Have) </span> </a> </li> <li class=md-nav__item> <a href=#heres-what-i-wish-id-known-transform-where-the-data-lives class=md-nav__link> <span class=md-ellipsis> Here's What I Wish I'd Known: Transform Where the Data Lives </span> </a> </li> <li class=md-nav__item> <a href=#my-hard-learned-rule class=md-nav__link> <span class=md-ellipsis> My Hard-Learned Rule </span> </a> </li> <li class=md-nav__item> <a href=#scars-ive-earned-etlelt-edition class=md-nav__link> <span class=md-ellipsis> Scars I've Earned: ETL/ELT Edition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-2-apache-airflow-the-orchestrator-i-didnt-know-i-needed class=md-nav__link> <span class=md-ellipsis> Section 2: Apache Airflow - The Orchestrator I Didn't Know I Needed </span> </a> <nav class=md-nav aria-label="Section 2: Apache Airflow - The Orchestrator I Didn't Know I Needed"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-cron-job-that-became-sentient-and-not-in-a-good-way class=md-nav__link> <span class=md-ellipsis> The Cron Job That Became Sentient (And Not In A Good Way) </span> </a> </li> <li class=md-nav__item> <a href=#heres-what-i-wish-id-known-orchestrators-are-your-new-best-friend class=md-nav__link> <span class=md-ellipsis> Here's What I Wish I'd Known: Orchestrators Are Your New Best Friend </span> </a> </li> <li class=md-nav__item> <a href=#example-converting-cron-chaos-to-airflow-clarity class=md-nav__link> <span class=md-ellipsis> Example: Converting Cron Chaos to Airflow Clarity </span> </a> </li> <li class=md-nav__item> <a href=#why-this-is-better-so-much-better class=md-nav__link> <span class=md-ellipsis> Why This Is Better (So Much Better) </span> </a> </li> <li class=md-nav__item> <a href=#scars-ive-earned-airflow-edition class=md-nav__link> <span class=md-ellipsis> Scars I've Earned: Airflow Edition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-3-idempotency-the-property-that-saves-careers class=md-nav__link> <span class=md-ellipsis> Section 3: Idempotency - The Property That Saves Careers </span> </a> <nav class=md-nav aria-label="Section 3: Idempotency - The Property That Saves Careers"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-append-that-appended-twice-million-times class=md-nav__link> <span class=md-ellipsis> The Append That Appended Twice (Million Times) </span> </a> </li> <li class=md-nav__item> <a href=#heres-what-i-wish-id-known-idempotency-is-non-negotiable class=md-nav__link> <span class=md-ellipsis> Here's What I Wish I'd Known: Idempotency Is Non-Negotiable </span> </a> </li> <li class=md-nav__item> <a href=#patterns-for-idempotent-pipelines class=md-nav__link> <span class=md-ellipsis> Patterns for Idempotent Pipelines </span> </a> </li> <li class=md-nav__item> <a href=#my-idempotency-checklist class=md-nav__link> <span class=md-ellipsis> My Idempotency Checklist </span> </a> </li> <li class=md-nav__item> <a href=#scars-ive-earned-idempotency-edition class=md-nav__link> <span class=md-ellipsis> Scars I've Earned: Idempotency Edition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#section-4-monitoring-alerting-because-hope-is-not-a-strategy class=md-nav__link> <span class=md-ellipsis> Section 4: Monitoring &amp; Alerting - Because Hope Is Not A Strategy </span> </a> <nav class=md-nav aria-label="Section 4: Monitoring & Alerting - Because Hope Is Not A Strategy"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-pipeline-that-failed-for-three-days-before-anyone-noticed class=md-nav__link> <span class=md-ellipsis> The Pipeline That Failed For Three Days (Before Anyone Noticed) </span> </a> </li> <li class=md-nav__item> <a href=#heres-what-i-wish-id-known-monitor-everything-that-matters class=md-nav__link> <span class=md-ellipsis> Here's What I Wish I'd Known: Monitor Everything That Matters </span> </a> </li> <li class=md-nav__item> <a href=#my-monitoring-pyramid class=md-nav__link> <span class=md-ellipsis> My Monitoring Pyramid </span> </a> </li> <li class=md-nav__item> <a href=#scars-ive-earned-monitoring-edition class=md-nav__link> <span class=md-ellipsis> Scars I've Earned: Monitoring Edition </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#summary class=md-nav__link> <span class=md-ellipsis> Summary </span> </a> </li> <li class=md-nav__item> <a href=#reflection-questions class=md-nav__link> <span class=md-ellipsis> Reflection Questions </span> </a> </li> <li class=md-nav__item> <a href=#next-steps class=md-nav__link> <span class=md-ellipsis> Next Steps </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=chapter-5-etlelt-apache-airflow>Chapter 5: ETL/ELT &amp; Apache Airflow<a class=headerlink href=#chapter-5-etlelt-apache-airflow title="Permanent link">&para;</a></h1> <h2 id=learning-objectives>Learning Objectives<a class=headerlink href=#learning-objectives title="Permanent link">&para;</a></h2> <p>By the end of this chapter, you will be able to: 1. <strong>Compare</strong> ETL and ELT patterns and select the appropriate approach based on data volume, transformation complexity, and infrastructure constraints 2. <strong>Design</strong> Apache Airflow DAGs with proper task dependencies, error handling, and retry logic for production data pipelines 3. <strong>Implement</strong> idempotent data transformations that can safely re-run without corrupting data or producing duplicates 4. <strong>Configure</strong> monitoring and alerting for data pipelines to detect failures before users notice them</p> <h2 id=introduction>Introduction<a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p>It's Tuesday, 11:47 PM. I'm at a bar with friends—actual non-engineer friends who think I have a "normal" job—when my Slack goes off. Then my phone. Then my personal email.</p> <p>The data science team's dashboard is blank. Not showing old data. Not showing errors. Just... blank. Like someone erased the entire company's metrics.</p> <p>I excuse myself, pull out my laptop (yes, I'm that person), and SSH into our data warehouse. The tables are there. The data is there. Yesterday's data. From 24 hours ago.</p> <p>Our overnight ETL pipeline—the one that runs every night at 2 AM to refresh the dashboards—never ran. It just... didn't wake up. Like it hit snooze and went back to sleep.</p> <p>I check our cron server. The cron job is there. I check the logs. Empty. No execution. No error. No trace that anything even tried to run.</p> <p>My "normal" Tuesday evening just became an archaeology expedition through six months of half-documented bash scripts, trying to figure out which server is supposed to be running what, and why none of it is actually running.</p> <p>This isn't a story about what went wrong. This is a story about how we were doing everything wrong from the start.</p> <p>Here's what nobody tells you when you're learning data engineering: The transform part? That's the easy part. The hard part is making sure your transformations actually <em>run</em> every day, in the right order, handling failures gracefully, and alerting you when things go sideways <em>before</em> the CEO asks why the dashboard is blank.</p> <p>Welcome to orchestration. Welcome to Apache Airflow. Welcome to the realization that "works on my laptop" is not the same as "runs reliably in production every single day for the next three years."</p> <h2 id=section-1-etl-vs-elt-the-great-debate-i-learned-the-hard-way>Section 1: ETL vs ELT - The Great Debate I Learned the Hard Way<a class=headerlink href=#section-1-etl-vs-elt-the-great-debate-i-learned-the-hard-way title="Permanent link">&para;</a></h2> <h3 id=the-day-i-processed-500gb-of-data-in-python-i-shouldnt-have>The Day I Processed 500GB Of Data In Python (I Shouldn't Have)<a class=headerlink href=#the-day-i-processed-500gb-of-data-in-python-i-shouldnt-have title="Permanent link">&para;</a></h3> <p>Let me paint you a picture of hubris.</p> <p>Six months into my second data engineering job, I get assigned "the integration." We're bringing in data from a new vendor—daily dumps of their entire transaction database. About 500GB per day, compressed. My job: extract it, clean it up, and load it into our warehouse.</p> <p>I'd just read a blog post about ETL. Extract, Transform, Load. Made perfect sense. Extract the data, transform it in Python (because I'm a Python wizard, obviously), then load the cleaned data into the warehouse.</p> <p>So I built this beautiful pipeline: 1. Download the compressed file from their S3 bucket 2. Decompress it (1.8TB uncompressed, but who's counting) 3. Read it into Pandas (because Pandas is awesome) 4. Clean it up: parse dates, fix data types, handle nulls 5. Load it into PostgreSQL</p> <p>Tested it on a sample file: 50MB. Worked beautifully. Deployment day came. I was confident.</p> <p>Sunday morning, 4 AM. My monitoring alert wakes me up: "ETL process killed by OOM (Out of Memory)."</p> <p>OOM? Out of memory? That's impossible. Our server has 64GB of RAM. Surely that's enough for...</p> <p>Oh no.</p> <p>I'd tried to load 1.8TB into Pandas. On a machine with 64GB of RAM. Pandas tried valiantly to comply, filled up all the RAM, started swapping to disk, thrashing so hard the server became unresponsive, and eventually the kernel just mercy-killed the process.</p> <p>The data science team woke up Monday to blank dashboards. Again.</p> <h3 id=heres-what-i-wish-id-known-transform-where-the-data-lives>Here's What I Wish I'd Known: Transform Where the Data Lives<a class=headerlink href=#heres-what-i-wish-id-known-transform-where-the-data-lives title="Permanent link">&para;</a></h3> <p>There are two philosophies in data engineering:</p> <p><strong>ETL (Extract, Transform, Load)</strong> - Transform data <em>before</em> loading it into the warehouse - Extract data from source systems - Transform it in intermediate processing (Python, Spark, etc.) - Load the cleaned data into the warehouse</p> <p><strong>ELT (Extract, Load, Transform)</strong> - Transform data <em>after</em> loading it into the warehouse - Extract data from source systems - Load it into the warehouse as-is (raw) - Transform it using SQL in the warehouse itself</p> <p>Neither is universally better. The right choice depends on your constraints.</p> <h4 id=when-etl-makes-sense>When ETL Makes Sense<a class=headerlink href=#when-etl-makes-sense title="Permanent link">&para;</a></h4> <p>Use ETL when: - <strong>Your source data is complex/semi-structured</strong> (JSON, XML, logs) and needs parsing - <strong>Your transformations are computationally heavy</strong> (ML models, complex parsing) - <strong>Your warehouse charges by the query</strong> (BigQuery, Snowflake with per-query pricing) - <strong>You're loading from many small sources</strong> and want to consolidate first</p> <p>Example: Processing server logs before loading:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1># ETL: Transform BEFORE loading</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kn>import</span><span class=w> </span><span class=nn>gzip</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kn>import</span><span class=w> </span><span class=nn>json</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=k>def</span><span class=w> </span><span class=nf>parse_log_line</span><span class=p>(</span><span class=n>line</span><span class=p>):</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Transform raw logs into structured data&quot;&quot;&quot;</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=n>log</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>    <span class=k>return</span> <span class=p>{</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>        <span class=s1>&#39;timestamp&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>fromisoformat</span><span class=p>(</span><span class=n>log</span><span class=p>[</span><span class=s1>&#39;ts&#39;</span><span class=p>]),</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>        <span class=s1>&#39;user_id&#39;</span><span class=p>:</span> <span class=n>log</span><span class=p>[</span><span class=s1>&#39;user&#39;</span><span class=p>],</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>        <span class=s1>&#39;event_type&#39;</span><span class=p>:</span> <span class=n>log</span><span class=p>[</span><span class=s1>&#39;event&#39;</span><span class=p>],</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>        <span class=s1>&#39;page_url&#39;</span><span class=p>:</span> <span class=n>log</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;page&#39;</span><span class=p>,</span> <span class=s1>&#39;unknown&#39;</span><span class=p>),</span>
</span><span id=__span-0-14><a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>        <span class=s1>&#39;duration_ms&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>log</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;duration&#39;</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span><span id=__span-0-15><a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>    <span class=p>}</span>
</span><span id=__span-0-16><a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>
</span><span id=__span-0-17><a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=k>def</span><span class=w> </span><span class=nf>extract_and_transform</span><span class=p>(</span><span class=n>log_file</span><span class=p>):</span>
</span><span id=__span-0-18><a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Generator that yields transformed records&quot;&quot;&quot;</span>
</span><span id=__span-0-19><a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>    <span class=k>with</span> <span class=n>gzip</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>log_file</span><span class=p>,</span> <span class=s1>&#39;rt&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-20><a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>        <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
</span><span id=__span-0-21><a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>            <span class=k>try</span><span class=p>:</span>
</span><span id=__span-0-22><a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>                <span class=k>yield</span> <span class=n>parse_log_line</span><span class=p>(</span><span class=n>line</span><span class=p>)</span>
</span><span id=__span-0-23><a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>            <span class=k>except</span> <span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>JSONDecodeError</span><span class=p>,</span> <span class=ne>KeyError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>)</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span><span id=__span-0-24><a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>                <span class=c1># Log errors but don&#39;t stop the pipeline</span>
</span><span id=__span-0-25><a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Skipped malformed log: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</span><span id=__span-0-26><a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>                <span class=k>continue</span>
</span><span id=__span-0-27><a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>
</span><span id=__span-0-28><a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=c1># Only load clean, structured data</span>
</span><span id=__span-0-29><a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=n>cleaned_logs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>extract_and_transform</span><span class=p>(</span><span class=s1>&#39;server_logs_2026-01-29.gz&#39;</span><span class=p>))</span>
</span><span id=__span-0-30><a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=n>load_to_warehouse</span><span class=p>(</span><span class=n>cleaned_logs</span><span class=p>)</span>
</span></code></pre></div> <p><strong>Why this works:</strong> JSON parsing in Python is easier than SQL. Errors are handled gracefully. Only valid data reaches the warehouse.</p> <h4 id=when-elt-makes-sense>When ELT Makes Sense<a class=headerlink href=#when-elt-makes-sense title="Permanent link">&para;</a></h4> <p>Use ELT when: - <strong>Your source data is already structured</strong> (CSV, Parquet, database dumps) - <strong>Your warehouse is powerful</strong> (BigQuery, Snowflake, Redshift with enough capacity) - <strong>You want transformation flexibility</strong> (business logic changes frequently) - <strong>You need reproducibility</strong> (can re-run transforms without re-extracting)</p> <p>Example: Loading vendor data then transforming in SQL:</p> <div class="language-sql highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>-- ELT: Load THEN transform</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=c1>-- Step 1: Load raw data (no transformation)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>raw_transactions</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=n>transaction_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>    </span><span class=n>customer_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=n>transaction_date</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>  </span><span class=c1>-- Still a string!</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>    </span><span class=n>amount</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span><span class=w>             </span><span class=c1>-- Still a string!</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=w>    </span><span class=n>currency</span><span class=w> </span><span class=n>STRING</span>
</span><span id=__span-1-10><a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a><span class=p>);</span>
</span><span id=__span-1-11><a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>
</span><span id=__span-1-12><a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a><span class=c1>-- Load everything as-is (fast, simple)</span>
</span><span id=__span-1-13><a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a><span class=k>LOAD</span><span class=w> </span><span class=k>DATA</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>raw_transactions</span>
</span><span id=__span-1-14><a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a><span class=k>FROM</span><span class=w> </span><span class=s1>&#39;gs://vendor-data/transactions_2026-01-29.csv&#39;</span><span class=p>;</span>
</span><span id=__span-1-15><a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>
</span><span id=__span-1-16><a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a><span class=c1>-- Step 2: Transform in SQL</span>
</span><span id=__span-1-17><a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a><span class=k>CREATE</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>REPLACE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>clean_transactions</span><span class=w> </span><span class=k>AS</span>
</span><span id=__span-1-18><a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=k>SELECT</span>
</span><span id=__span-1-19><a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a><span class=w>    </span><span class=n>transaction_id</span><span class=p>,</span>
</span><span id=__span-1-20><a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=w>    </span><span class=n>customer_id</span><span class=p>,</span>
</span><span id=__span-1-21><a id=__codelineno-1-21 name=__codelineno-1-21 href=#__codelineno-1-21></a><span class=w>    </span><span class=n>PARSE_DATE</span><span class=p>(</span><span class=s1>&#39;%Y-%m-%d&#39;</span><span class=p>,</span><span class=w> </span><span class=n>transaction_date</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>transaction_date</span><span class=p>,</span>
</span><span id=__span-1-22><a id=__codelineno-1-22 name=__codelineno-1-22 href=#__codelineno-1-22></a><span class=w>    </span><span class=k>CAST</span><span class=p>(</span><span class=n>amount</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>FLOAT64</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>amount</span><span class=p>,</span>
</span><span id=__span-1-23><a id=__codelineno-1-23 name=__codelineno-1-23 href=#__codelineno-1-23></a><span class=w>    </span><span class=n>currency</span><span class=p>,</span>
</span><span id=__span-1-24><a id=__codelineno-1-24 name=__codelineno-1-24 href=#__codelineno-1-24></a><span class=w>    </span><span class=c1>-- Apply business logic</span>
</span><span id=__span-1-25><a id=__codelineno-1-25 name=__codelineno-1-25 href=#__codelineno-1-25></a><span class=w>    </span><span class=k>CASE</span>
</span><span id=__span-1-26><a id=__codelineno-1-26 name=__codelineno-1-26 href=#__codelineno-1-26></a><span class=w>        </span><span class=k>WHEN</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10000</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;high_value&#39;</span>
</span><span id=__span-1-27><a id=__codelineno-1-27 name=__codelineno-1-27 href=#__codelineno-1-27></a><span class=w>        </span><span class=k>WHEN</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1000</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;medium_value&#39;</span>
</span><span id=__span-1-28><a id=__codelineno-1-28 name=__codelineno-1-28 href=#__codelineno-1-28></a><span class=w>        </span><span class=k>ELSE</span><span class=w> </span><span class=s1>&#39;low_value&#39;</span>
</span><span id=__span-1-29><a id=__codelineno-1-29 name=__codelineno-1-29 href=#__codelineno-1-29></a><span class=w>    </span><span class=k>END</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>transaction_tier</span>
</span><span id=__span-1-30><a id=__codelineno-1-30 name=__codelineno-1-30 href=#__codelineno-1-30></a><span class=k>FROM</span><span class=w> </span><span class=n>raw_transactions</span>
</span><span id=__span-1-31><a id=__codelineno-1-31 name=__codelineno-1-31 href=#__codelineno-1-31></a><span class=k>WHERE</span><span class=w> </span><span class=n>transaction_date</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w>  </span><span class=c1>-- Filter bad data</span>
</span><span id=__span-1-32><a id=__codelineno-1-32 name=__codelineno-1-32 href=#__codelineno-1-32></a><span class=w>    </span><span class=k>AND</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span>
</span></code></pre></div> <p><strong>Why this works:</strong> BigQuery can scan and transform terabytes in seconds. If business logic changes, just re-run the transform (no re-download). Failed transforms don't affect raw data.</p> <h3 id=my-hard-learned-rule>My Hard-Learned Rule<a class=headerlink href=#my-hard-learned-rule title="Permanent link">&para;</a></h3> <p>After that 4 AM disaster, here's the rule I follow:</p> <blockquote> <p>If your warehouse can handle the transformation faster than you can download the data, use ELT.</p> </blockquote> <p>In my case: - <strong>Download + decompress:</strong> 45 minutes for 500GB - <strong>BigQuery scan + transform:</strong> 2 minutes for 1.8TB</p> <p>The math was obvious once I stopped being stubborn about Python.</p> <h3 id=scars-ive-earned-etlelt-edition>Scars I've Earned: ETL/ELT Edition<a class=headerlink href=#scars-ive-earned-etlelt-edition title="Permanent link">&para;</a></h3> <p><strong>Scar #1: Tried to transform 1.8TB in Pandas</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;huge_file.csv&#39;</span><span class=p>)</span>  <span class=c1># OOM killer has entered the chat</span>
</span></code></pre></div> <strong>What it cost me:</strong> A Sunday morning, confused data scientists, and a lecture about resource limits</p> <p><strong>Scar #2: Loaded raw data without checking first</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1>-- DON&#39;T</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=k>LOAD</span><span class=w> </span><span class=k>DATA</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>production_table</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=k>FROM</span><span class=w> </span><span class=s1>&#39;gs://untrusted-vendor/data.csv&#39;</span><span class=p>;</span><span class=w>  </span><span class=c1>-- Hope and pray</span>
</span></code></pre></div> <strong>What it cost me:</strong> 47 million rows of garbage data in production, a 3-hour rollback, and zero trust from my team</p> <p><strong>Scar #3: Hardcoded credentials in the ETL script</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>conn</span> <span class=o>=</span> <span class=n>psycopg2</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=s2>&quot;host=prod-db.company.com user=admin password=hunter2&quot;</span>  <span class=c1># In git history forever</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=p>)</span>
</span></code></pre></div> <strong>What it cost me:</strong> A security audit finding, mandatory security training, and explaining to my manager why I committed passwords to GitHub</p> <h2 id=section-2-apache-airflow-the-orchestrator-i-didnt-know-i-needed>Section 2: Apache Airflow - The Orchestrator I Didn't Know I Needed<a class=headerlink href=#section-2-apache-airflow-the-orchestrator-i-didnt-know-i-needed title="Permanent link">&para;</a></h2> <h3 id=the-cron-job-that-became-sentient-and-not-in-a-good-way>The Cron Job That Became Sentient (And Not In A Good Way)<a class=headerlink href=#the-cron-job-that-became-sentient-and-not-in-a-good-way title="Permanent link">&para;</a></h3> <p>Remember that Tuesday night at the bar? The ETL pipeline that just... didn't run? Let me tell you how I got into that mess.</p> <p>When I first started building data pipelines, I used cron. Everyone uses cron, right? It's simple:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=c1># Run ETL every day at 2 AM</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=m>0</span><span class=w> </span><span class=m>2</span><span class=w> </span>*<span class=w> </span>*<span class=w> </span>*<span class=w> </span>/home/me/etl/run_pipeline.sh
</span></code></pre></div> <p>Clean. Simple. One line.</p> <p>Then the requirements evolved: - "Can we run this twice a day?" - "Can we wait for the vendor file before starting?" - "Can we retry if it fails?" - "Can we run step 2 only if step 1 succeeds?" - "Can we send a Slack alert if it fails?" - "Can we see a history of what ran when?"</p> <p>Six months later, I had 47 cron jobs across 3 servers, a tangle of bash scripts checking for lock files, and absolutely zero visibility into what was running, what failed, and what was just... stuck.</p> <p>That Tuesday night disaster? One of our three cron servers had been rebooted for maintenance. The cron jobs didn't start. Nobody noticed for 24 hours because there was no monitoring.</p> <p>My senior engineer sat me down Wednesday morning: "Have you heard of Apache Airflow?"</p> <p>I hadn't.</p> <p>"Let me show you something," she said.</p> <h3 id=heres-what-i-wish-id-known-orchestrators-are-your-new-best-friend>Here's What I Wish I'd Known: Orchestrators Are Your New Best Friend<a class=headerlink href=#heres-what-i-wish-id-known-orchestrators-are-your-new-best-friend title="Permanent link">&para;</a></h3> <p>Apache Airflow is a platform to programmatically author, schedule, and monitor workflows. Think of it as "cron on steroids with a web UI and actual error handling."</p> <p>The core concepts:</p> <p><strong>DAG (Directed Acyclic Graph):</strong> A workflow—a collection of tasks with dependencies - "Directed" = tasks have a specific order - "Acyclic" = no circular dependencies (task A can't depend on task B if B depends on A) - "Graph" = visual representation of tasks and their relationships</p> <p><strong>Task:</strong> A single unit of work (run a SQL query, call an API, execute Python)</p> <p><strong>Operator:</strong> A template for a task (PythonOperator, BashOperator, SQLOperator)</p> <p><strong>Dependencies:</strong> Relationships between tasks (task B runs after task A completes)</p> <h3 id=example-converting-cron-chaos-to-airflow-clarity>Example: Converting Cron Chaos to Airflow Clarity<a class=headerlink href=#example-converting-cron-chaos-to-airflow-clarity title="Permanent link">&para;</a></h3> <p>Here's what my cron disaster looked like:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># run_etl.sh - good luck maintaining this</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=c1>#!/bin/bash</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nb>set</span><span class=w> </span>-e
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=c1># Step 1: Check if vendor file exists</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a><span class=k>while</span><span class=w> </span>true<span class=p>;</span><span class=w> </span><span class=k>do</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=w>    </span><span class=k>if</span><span class=w> </span>aws<span class=w> </span>s3<span class=w> </span>ls<span class=w> </span>s3://vendor/data_<span class=k>$(</span>date<span class=w> </span>+%Y%m%d<span class=k>)</span>.csv<span class=p>;</span><span class=w> </span><span class=k>then</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=w>        </span><span class=k>break</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a><span class=w>    </span><span class=k>fi</span>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=w>    </span>sleep<span class=w> </span><span class=m>300</span><span class=w>  </span><span class=c1># Wait 5 minutes</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=k>done</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a><span class=c1># Step 2: Download it</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>aws<span class=w> </span>s3<span class=w> </span>cp<span class=w> </span>s3://vendor/data_<span class=k>$(</span>date<span class=w> </span>+%Y%m%d<span class=k>)</span>.csv<span class=w> </span>/tmp/
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=c1># Step 3: Run transform</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a>python<span class=w> </span>/home/me/etl/transform.py<span class=w> </span>/tmp/data_<span class=k>$(</span>date<span class=w> </span>+%Y%m%d<span class=k>)</span>.csv
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a><span class=c1># Step 4: Load to warehouse</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a>python<span class=w> </span>/home/me/etl/load.py<span class=w> </span>/tmp/data_<span class=k>$(</span>date<span class=w> </span>+%Y%m%d<span class=k>)</span>.csv
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=c1># If we got here, send success notification</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a>curl<span class=w> </span>-X<span class=w> </span>POST<span class=w> </span>-H<span class=w> </span><span class=s1>&#39;Content-type: application/json&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a><span class=w>    </span>--data<span class=w> </span><span class=s1>&#39;{&quot;text&quot;:&quot;ETL completed&quot;}&#39;</span><span class=w> </span><span class=se>\</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a><span class=w>    </span>https://hooks.slack.com/services/XXX
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a><span class=c1># If anything failed, cron will email me. Maybe. If email is configured. Is it?</span>
</span></code></pre></div> <p>Here's the same workflow in Airflow:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow</span><span class=w> </span><span class=kn>import</span> <span class=n>DAG</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow.operators.python</span><span class=w> </span><span class=kn>import</span> <span class=n>PythonOperator</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow.providers.amazon.aws.sensors.s3</span><span class=w> </span><span class=kn>import</span> <span class=n>S3KeySensor</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow.providers.postgres.operators.postgres</span><span class=w> </span><span class=kn>import</span> <span class=n>PostgresOperator</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow.operators.slack</span><span class=w> </span><span class=kn>import</span> <span class=n>SlackAPIPostOperator</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=kn>from</span><span class=w> </span><span class=nn>datetime</span><span class=w> </span><span class=kn>import</span> <span class=n>datetime</span><span class=p>,</span> <span class=n>timedelta</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=c1># Default settings for all tasks</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=n>default_args</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>    <span class=s1>&#39;owner&#39;</span><span class=p>:</span> <span class=s1>&#39;data-eng-team&#39;</span><span class=p>,</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>    <span class=s1>&#39;depends_on_past&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>  <span class=c1># Don&#39;t wait for previous runs</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>    <span class=s1>&#39;start_date&#39;</span><span class=p>:</span> <span class=n>datetime</span><span class=p>(</span><span class=mi>2026</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>    <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;alerts@company.com&#39;</span><span class=p>],</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>    <span class=s1>&#39;email_on_failure&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>    <span class=s1>&#39;email_on_retry&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>    <span class=s1>&#39;retries&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>  <span class=c1># Retry up to 3 times</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>    <span class=s1>&#39;retry_delay&#39;</span><span class=p>:</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>5</span><span class=p>),</span>  <span class=c1># Wait 5 min between retries</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a><span class=p>}</span>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a><span class=c1># Define the workflow</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a>    <span class=s1>&#39;vendor_etl_pipeline&#39;</span><span class=p>,</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>    <span class=n>default_args</span><span class=o>=</span><span class=n>default_args</span><span class=p>,</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a>    <span class=n>description</span><span class=o>=</span><span class=s1>&#39;Daily vendor data ETL&#39;</span><span class=p>,</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a>    <span class=n>schedule_interval</span><span class=o>=</span><span class=s1>&#39;0 2 * * *&#39;</span><span class=p>,</span>  <span class=c1># 2 AM daily</span>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>  <span class=c1># Don&#39;t backfill old runs</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;etl&#39;</span><span class=p>,</span> <span class=s1>&#39;vendor&#39;</span><span class=p>,</span> <span class=s1>&#39;production&#39;</span><span class=p>],</span>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a>    <span class=c1># Task 1: Wait for vendor file</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>    <span class=n>wait_for_file</span> <span class=o>=</span> <span class=n>S3KeySensor</span><span class=p>(</span>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;wait_for_vendor_file&#39;</span><span class=p>,</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a>        <span class=n>bucket_name</span><span class=o>=</span><span class=s1>&#39;vendor-data&#39;</span><span class=p>,</span>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>        <span class=n>bucket_key</span><span class=o>=</span><span class=s1>&#39;data_{{ ds_nodash }}.csv&#39;</span><span class=p>,</span>  <span class=c1># ds_nodash = YYYYMMDD</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a>        <span class=n>poke_interval</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span>  <span class=c1># Check every 5 minutes</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>        <span class=n>timeout</span><span class=o>=</span><span class=mi>7200</span><span class=p>,</span>  <span class=c1># Give up after 2 hours</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>        <span class=n>mode</span><span class=o>=</span><span class=s1>&#39;poke&#39;</span><span class=p>,</span>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>    <span class=p>)</span>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a>    <span class=c1># Task 2: Download and transform</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a>    <span class=k>def</span><span class=w> </span><span class=nf>extract_and_transform</span><span class=p>(</span><span class=o>**</span><span class=n>context</span><span class=p>):</span>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>        <span class=kn>import</span><span class=w> </span><span class=nn>boto3</span>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a>        <span class=kn>import</span><span class=w> </span><span class=nn>pandas</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nn>pd</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a>        <span class=kn>from</span><span class=w> </span><span class=nn>etl.transform</span><span class=w> </span><span class=kn>import</span> <span class=n>clean_data</span>
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a>
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a>        <span class=c1># Get execution date from Airflow context</span>
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a>        <span class=n>execution_date</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s1>&#39;ds_nodash&#39;</span><span class=p>]</span>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a>
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a>        <span class=c1># Download</span>
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a>        <span class=n>s3</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;s3&#39;</span><span class=p>)</span>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a>        <span class=n>local_file</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/tmp/data_</span><span class=si>{</span><span class=n>execution_date</span><span class=si>}</span><span class=s1>.csv&#39;</span>
</span><span id=__span-7-52><a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a>        <span class=n>s3</span><span class=o>.</span><span class=n>download_file</span><span class=p>(</span><span class=s1>&#39;vendor-data&#39;</span><span class=p>,</span> <span class=sa>f</span><span class=s1>&#39;data_</span><span class=si>{</span><span class=n>execution_date</span><span class=si>}</span><span class=s1>.csv&#39;</span><span class=p>,</span> <span class=n>local_file</span><span class=p>)</span>
</span><span id=__span-7-53><a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a>
</span><span id=__span-7-54><a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a>        <span class=c1># Transform</span>
</span><span id=__span-7-55><a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a>        <span class=n>df</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=n>local_file</span><span class=p>,</span> <span class=n>chunksize</span><span class=o>=</span><span class=mi>100000</span><span class=p>)</span>  <span class=c1># Process in chunks!</span>
</span><span id=__span-7-56><a id=__codelineno-7-56 name=__codelineno-7-56 href=#__codelineno-7-56></a>        <span class=n>cleaned</span> <span class=o>=</span> <span class=n>clean_data</span><span class=p>(</span><span class=n>df</span><span class=p>)</span>
</span><span id=__span-7-57><a id=__codelineno-7-57 name=__codelineno-7-57 href=#__codelineno-7-57></a>        <span class=n>cleaned</span><span class=o>.</span><span class=n>to_parquet</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;/tmp/cleaned_</span><span class=si>{</span><span class=n>execution_date</span><span class=si>}</span><span class=s1>.parquet&#39;</span><span class=p>)</span>
</span><span id=__span-7-58><a id=__codelineno-7-58 name=__codelineno-7-58 href=#__codelineno-7-58></a>
</span><span id=__span-7-59><a id=__codelineno-7-59 name=__codelineno-7-59 href=#__codelineno-7-59></a>        <span class=k>return</span> <span class=sa>f</span><span class=s1>&#39;/tmp/cleaned_</span><span class=si>{</span><span class=n>execution_date</span><span class=si>}</span><span class=s1>.parquet&#39;</span>
</span><span id=__span-7-60><a id=__codelineno-7-60 name=__codelineno-7-60 href=#__codelineno-7-60></a>
</span><span id=__span-7-61><a id=__codelineno-7-61 name=__codelineno-7-61 href=#__codelineno-7-61></a>    <span class=n>transform</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span>
</span><span id=__span-7-62><a id=__codelineno-7-62 name=__codelineno-7-62 href=#__codelineno-7-62></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;extract_and_transform&#39;</span><span class=p>,</span>
</span><span id=__span-7-63><a id=__codelineno-7-63 name=__codelineno-7-63 href=#__codelineno-7-63></a>        <span class=n>python_callable</span><span class=o>=</span><span class=n>extract_and_transform</span><span class=p>,</span>
</span><span id=__span-7-64><a id=__codelineno-7-64 name=__codelineno-7-64 href=#__codelineno-7-64></a>        <span class=n>provide_context</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-7-65><a id=__codelineno-7-65 name=__codelineno-7-65 href=#__codelineno-7-65></a>    <span class=p>)</span>
</span><span id=__span-7-66><a id=__codelineno-7-66 name=__codelineno-7-66 href=#__codelineno-7-66></a>
</span><span id=__span-7-67><a id=__codelineno-7-67 name=__codelineno-7-67 href=#__codelineno-7-67></a>    <span class=c1># Task 3: Load to warehouse</span>
</span><span id=__span-7-68><a id=__codelineno-7-68 name=__codelineno-7-68 href=#__codelineno-7-68></a>    <span class=n>load</span> <span class=o>=</span> <span class=n>PostgresOperator</span><span class=p>(</span>
</span><span id=__span-7-69><a id=__codelineno-7-69 name=__codelineno-7-69 href=#__codelineno-7-69></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;load_to_warehouse&#39;</span><span class=p>,</span>
</span><span id=__span-7-70><a id=__codelineno-7-70 name=__codelineno-7-70 href=#__codelineno-7-70></a>        <span class=n>postgres_conn_id</span><span class=o>=</span><span class=s1>&#39;prod_warehouse&#39;</span><span class=p>,</span>  <span class=c1># Connection defined in Airflow UI</span>
</span><span id=__span-7-71><a id=__codelineno-7-71 name=__codelineno-7-71 href=#__codelineno-7-71></a>        <span class=n>sql</span><span class=o>=</span><span class=s1>&#39;&#39;&#39;</span>
</span><span id=__span-7-72><a id=__codelineno-7-72 name=__codelineno-7-72 href=#__codelineno-7-72></a><span class=s1>            COPY transactions</span>
</span><span id=__span-7-73><a id=__codelineno-7-73 name=__codelineno-7-73 href=#__codelineno-7-73></a><span class=s1>            FROM &#39;{{ ti.xcom_pull(task_ids=&quot;extract_and_transform&quot;) }}&#39;</span>
</span><span id=__span-7-74><a id=__codelineno-7-74 name=__codelineno-7-74 href=#__codelineno-7-74></a><span class=s1>            WITH (FORMAT parquet);</span>
</span><span id=__span-7-75><a id=__codelineno-7-75 name=__codelineno-7-75 href=#__codelineno-7-75></a><span class=s1>        &#39;&#39;&#39;</span><span class=p>,</span>
</span><span id=__span-7-76><a id=__codelineno-7-76 name=__codelineno-7-76 href=#__codelineno-7-76></a>    <span class=p>)</span>
</span><span id=__span-7-77><a id=__codelineno-7-77 name=__codelineno-7-77 href=#__codelineno-7-77></a>
</span><span id=__span-7-78><a id=__codelineno-7-78 name=__codelineno-7-78 href=#__codelineno-7-78></a>    <span class=c1># Task 4: Notify success</span>
</span><span id=__span-7-79><a id=__codelineno-7-79 name=__codelineno-7-79 href=#__codelineno-7-79></a>    <span class=n>notify</span> <span class=o>=</span> <span class=n>SlackAPIPostOperator</span><span class=p>(</span>
</span><span id=__span-7-80><a id=__codelineno-7-80 name=__codelineno-7-80 href=#__codelineno-7-80></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;notify_success&#39;</span><span class=p>,</span>
</span><span id=__span-7-81><a id=__codelineno-7-81 name=__codelineno-7-81 href=#__codelineno-7-81></a>        <span class=n>slack_conn_id</span><span class=o>=</span><span class=s1>&#39;slack_data_alerts&#39;</span><span class=p>,</span>
</span><span id=__span-7-82><a id=__codelineno-7-82 name=__codelineno-7-82 href=#__codelineno-7-82></a>        <span class=n>channel</span><span class=o>=</span><span class=s1>&#39;#data-pipeline-status&#39;</span><span class=p>,</span>
</span><span id=__span-7-83><a id=__codelineno-7-83 name=__codelineno-7-83 href=#__codelineno-7-83></a>        <span class=n>text</span><span class=o>=</span><span class=s1>&#39;✅ Vendor ETL completed successfully for {{ ds }}&#39;</span><span class=p>,</span>
</span><span id=__span-7-84><a id=__codelineno-7-84 name=__codelineno-7-84 href=#__codelineno-7-84></a>    <span class=p>)</span>
</span><span id=__span-7-85><a id=__codelineno-7-85 name=__codelineno-7-85 href=#__codelineno-7-85></a>
</span><span id=__span-7-86><a id=__codelineno-7-86 name=__codelineno-7-86 href=#__codelineno-7-86></a>    <span class=c1># Define dependencies: wait → transform → load → notify</span>
</span><span id=__span-7-87><a id=__codelineno-7-87 name=__codelineno-7-87 href=#__codelineno-7-87></a>    <span class=n>wait_for_file</span> <span class=o>&gt;&gt;</span> <span class=n>transform</span> <span class=o>&gt;&gt;</span> <span class=n>load</span> <span class=o>&gt;&gt;</span> <span class=n>notify</span>
</span></code></pre></div> <h3 id=why-this-is-better-so-much-better>Why This Is Better (So Much Better)<a class=headerlink href=#why-this-is-better-so-much-better title="Permanent link">&para;</a></h3> <p><strong>1. Visual Dependency Graph</strong></p> <p>Airflow renders this as a nice graph showing what runs when:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>[wait_for_vendor_file] → [extract_and_transform] → [load_to_warehouse] → [notify_success]
</span></code></pre></div> <p>Click on any task to see logs, duration, retry attempts, and whether it succeeded or failed.</p> <p><strong>2. Automatic Retries</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=s1>&#39;retries&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=s1>&#39;retry_delay&#39;</span><span class=p>:</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>5</span><span class=p>),</span>
</span></code></pre></div> <p>Transient failures (network blip, database deadlock) get automatically retried. No more 3 AM wake-ups for issues that would've fixed themselves.</p> <p><strong>3. Built-in Monitoring</strong></p> <ul> <li>Web UI shows all your DAGs</li> <li>Click into any DAG to see run history</li> <li>Green = success, Red = failed, Yellow = running</li> <li>Get alerts only when retries are exhausted</li> </ul> <p><strong>4. Idempotency Awareness</strong></p> <p>Notice this in the DAG definition:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=s1>&#39;depends_on_past&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>
</span></code></pre></div> <p>This means "today's run doesn't depend on yesterday's success." If yesterday failed, today still runs. This is huge for recovering from failures.</p> <p><strong>5. Templating with Jinja</strong></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>bucket_key</span><span class=o>=</span><span class=s1>&#39;data_{{ ds_nodash }}.csv&#39;</span>  <span class=c1># Airflow replaces with execution date</span>
</span></code></pre></div> <p>Airflow provides variables: - <code>{{ ds }}</code> = execution date (YYYY-MM-DD) - <code>{{ ds_nodash }}</code> = execution date (YYYYMMDD) - <code>{{ ti }}</code> = task instance (for passing data between tasks)</p> <h3 id=scars-ive-earned-airflow-edition>Scars I've Earned: Airflow Edition<a class=headerlink href=#scars-ive-earned-airflow-edition title="Permanent link">&para;</a></h3> <p><strong>Scar #1: Set <code>depends_on_past=True</code> globally</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>default_args</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=s1>&#39;depends_on_past&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>  <span class=c1># One failure blocks all future runs</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=p>}</span>
</span></code></pre></div> <strong>What it cost me:</strong> A Monday pipeline failure that prevented all runs for the rest of the week until I manually cleared the failed task</p> <p><strong>Scar #2: Used huge retries without exponential backoff</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=s1>&#39;retries&#39;</span><span class=p>:</span> <span class=mi>100</span><span class=p>,</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=s1>&#39;retry_delay&#39;</span><span class=p>:</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>seconds</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>  <span class=c1># Hammer the API 100 times</span>
</span></code></pre></div> <strong>What it cost me:</strong> Got our IP address blocked by the vendor's API for "abuse," had to call them and apologize</p> <p><strong>Scar #3: Forgot <code>catchup=False</code> on a new DAG</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>    <span class=s1>&#39;new_pipeline&#39;</span><span class=p>,</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>    <span class=n>start_date</span><span class=o>=</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span>  <span class=c1># 1 year ago</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>    <span class=n>schedule_interval</span><span class=o>=</span><span class=s1>&#39;@daily&#39;</span><span class=p>,</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>    <span class=c1># catchup=True is the default!</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=p>)</span>
</span></code></pre></div> <strong>What it cost me:</strong> Airflow immediately scheduled 365 backfill runs, overwhelmed our database, and I had to manually delete all of them</p> <h2 id=section-3-idempotency-the-property-that-saves-careers>Section 3: Idempotency - The Property That Saves Careers<a class=headerlink href=#section-3-idempotency-the-property-that-saves-careers title="Permanent link">&para;</a></h2> <h3 id=the-append-that-appended-twice-million-times>The Append That Appended Twice (Million Times)<a class=headerlink href=#the-append-that-appended-twice-million-times title="Permanent link">&para;</a></h3> <p>It's Wednesday. Our daily sales report is due to the executive team by 9 AM. The report comes from a simple pipeline that runs every night:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=c1># Extract yesterday&#39;s sales</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=n>sales</span> <span class=o>=</span> <span class=n>extract_sales_data</span><span class=p>(</span><span class=n>yesterday</span><span class=p>)</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=c1># Load into the reporting table</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=n>append_to_table</span><span class=p>(</span><span class=s1>&#39;daily_sales_report&#39;</span><span class=p>,</span> <span class=n>sales</span><span class=p>)</span>
</span></code></pre></div> <p>Clean. Simple. Worked perfectly for six months.</p> <p>Then one Tuesday night, our database had a brief network hiccup. The pipeline's <code>append_to_table</code> call failed with a timeout. Airflow's retry mechanism kicked in (good Airflow!). The insert succeeded on retry.</p> <p>Wednesday morning, 7:45 AM. I'm having coffee when Slack lights up:</p> <p>"Why does yesterday's revenue show $4.8M instead of $2.4M?"</p> <p>Oh no.</p> <p>The first attempt actually <em>did</em> succeed—the network timeout happened after the commit but before the acknowledgment reached our script. So when Airflow retried, it inserted the same data again.</p> <p>Every row. Twice.</p> <p>I spent the next 75 minutes trying to de-duplicate the table before the executive meeting, praying I could figure out which rows were the real ones and which were duplicates.</p> <p>I couldn't. We went into the meeting with wrong numbers. The CFO made decisions based on revenue that was literally double the truth.</p> <p>That afternoon, my tech lead introduced me to a word I'd never forget: "idempotent."</p> <h3 id=heres-what-i-wish-id-known-idempotency-is-non-negotiable>Here's What I Wish I'd Known: Idempotency Is Non-Negotiable<a class=headerlink href=#heres-what-i-wish-id-known-idempotency-is-non-negotiable title="Permanent link">&para;</a></h3> <p><strong>Idempotent</strong> (adjective): An operation that produces the same result no matter how many times you run it.</p> <p>Examples: - <strong>Idempotent:</strong> <code>UPDATE users SET status = 'active' WHERE user_id = 123</code> - Run it once: user 123 is active - Run it 100 times: user 123 is still active (same result)</p> <ul> <li><strong>NOT idempotent:</strong> <code>INSERT INTO users (user_id, status) VALUES (123, 'active')</code></li> <li>Run it once: one row inserted</li> <li>Run it twice: two rows inserted (or duplicate key error)</li> </ul> <p>In data pipelines, idempotency means:</p> <blockquote> <p>If the same pipeline runs twice with the same input, it produces the same output.</p> </blockquote> <p>This is crucial because: - Networks fail mid-operation - Retries happen automatically - Humans accidentally click "run" twice - Backfills re-process old data</p> <h3 id=patterns-for-idempotent-pipelines>Patterns for Idempotent Pipelines<a class=headerlink href=#patterns-for-idempotent-pipelines title="Permanent link">&para;</a></h3> <h4 id=pattern-1-delete-insert-not-great-but-simple>Pattern 1: DELETE + INSERT (Not Great, But Simple)<a class=headerlink href=#pattern-1-delete-insert-not-great-but-simple title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>def</span><span class=w> </span><span class=nf>load_sales_data_v1</span><span class=p>(</span><span class=n>date</span><span class=p>):</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Delete existing data for this date, then insert&quot;&quot;&quot;</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>    <span class=c1># Delete any existing data</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>    <span class=n>execute_sql</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;DELETE FROM daily_sales_report WHERE date = &#39;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>&#39;&quot;</span><span class=p>)</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>    <span class=c1># Insert new data</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a>    <span class=n>sales</span> <span class=o>=</span> <span class=n>extract_sales_data</span><span class=p>(</span><span class=n>date</span><span class=p>)</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>    <span class=n>insert_into_table</span><span class=p>(</span><span class=s1>&#39;daily_sales_report&#39;</span><span class=p>,</span> <span class=n>sales</span><span class=p>)</span>
</span></code></pre></div> <p><strong>Pros:</strong> Simple, guarantees no duplicates <strong>Cons:</strong> Not atomic (delete and insert aren't in a transaction), lose data if insert fails</p> <h4 id=pattern-2-merge-upsert-better>Pattern 2: MERGE / UPSERT (Better)<a class=headerlink href=#pattern-2-merge-upsert-better title="Permanent link">&para;</a></h4> <div class="language-sql highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1>-- PostgreSQL MERGE (INSERT ... ON CONFLICT UPDATE)</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>daily_sales_report</span><span class=w> </span><span class=p>(</span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>product_id</span><span class=p>,</span><span class=w> </span><span class=n>revenue</span><span class=p>,</span><span class=w> </span><span class=n>units_sold</span><span class=p>)</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;2026-01-29&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;PROD-123&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>1500</span><span class=p>.</span><span class=mi>00</span><span class=p>,</span><span class=w> </span><span class=mi>42</span><span class=p>)</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=k>ON</span><span class=w> </span><span class=n>CONFLICT</span><span class=w> </span><span class=p>(</span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>product_id</span><span class=p>)</span><span class=w>  </span><span class=c1>-- If this combination exists</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=k>DO</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>SET</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>    </span><span class=n>revenue</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EXCLUDED</span><span class=p>.</span><span class=n>revenue</span><span class=p>,</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>    </span><span class=n>units_sold</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>EXCLUDED</span><span class=p>.</span><span class=n>units_sold</span><span class=p>,</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>    </span><span class=n>updated_at</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>NOW</span><span class=p>();</span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># BigQuery MERGE</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=n>MERGE</span> <span class=n>INTO</span> <span class=n>daily_sales_report</span> <span class=n>AS</span> <span class=n>target</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=n>USING</span> <span class=n>new_sales_data</span> <span class=n>AS</span> <span class=n>source</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=n>ON</span> <span class=n>target</span><span class=o>.</span><span class=n>date</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>date</span> <span class=n>AND</span> <span class=n>target</span><span class=o>.</span><span class=n>product_id</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>product_id</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=n>WHEN</span> <span class=n>MATCHED</span> <span class=n>THEN</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>    <span class=n>UPDATE</span> <span class=n>SET</span> <span class=n>revenue</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>revenue</span><span class=p>,</span> <span class=n>units_sold</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>units_sold</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=n>WHEN</span> <span class=n>NOT</span> <span class=n>MATCHED</span> <span class=n>THEN</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>    <span class=n>INSERT</span> <span class=p>(</span><span class=n>date</span><span class=p>,</span> <span class=n>product_id</span><span class=p>,</span> <span class=n>revenue</span><span class=p>,</span> <span class=n>units_sold</span><span class=p>)</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>    <span class=n>VALUES</span> <span class=p>(</span><span class=n>source</span><span class=o>.</span><span class=n>date</span><span class=p>,</span> <span class=n>source</span><span class=o>.</span><span class=n>product_id</span><span class=p>,</span> <span class=n>source</span><span class=o>.</span><span class=n>revenue</span><span class=p>,</span> <span class=n>source</span><span class=o>.</span><span class=n>units_sold</span><span class=p>);</span>
</span></code></pre></div> <p><strong>Pros:</strong> Atomic, handles both inserts and updates <strong>Cons:</strong> Requires unique key constraint</p> <h4 id=pattern-3-staging-table-swap-best-for-large-loads>Pattern 3: Staging Table + Swap (Best for Large Loads)<a class=headerlink href=#pattern-3-staging-table-swap-best-for-large-loads title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>def</span><span class=w> </span><span class=nf>load_sales_data_v3</span><span class=p>(</span><span class=n>date</span><span class=p>):</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Load into staging, validate, then swap&quot;&quot;&quot;</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>    <span class=c1># Load into temporary staging table</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>    <span class=n>staging_table</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;daily_sales_staging_</span><span class=si>{</span><span class=n>date</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a>    <span class=n>create_table</span><span class=p>(</span><span class=n>staging_table</span><span class=p>)</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a>    <span class=n>insert_into_table</span><span class=p>(</span><span class=n>staging_table</span><span class=p>,</span> <span class=n>extract_sales_data</span><span class=p>(</span><span class=n>date</span><span class=p>))</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a>    <span class=c1># Validate data</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>    <span class=k>if</span> <span class=ow>not</span> <span class=n>validate_sales_data</span><span class=p>(</span><span class=n>staging_table</span><span class=p>):</span>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Data validation failed!&quot;</span><span class=p>)</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>    <span class=c1># Atomic swap</span>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a>    <span class=n>execute_sql</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=s2>        BEGIN;</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=s2>        DELETE FROM daily_sales_report WHERE date = &#39;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>&#39;;</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=s2>        INSERT INTO daily_sales_report SELECT * FROM </span><span class=si>{</span><span class=n>staging_table</span><span class=si>}</span><span class=s2>;</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=s2>        DROP TABLE </span><span class=si>{</span><span class=n>staging_table</span><span class=si>}</span><span class=s2>;</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a><span class=s2>        COMMIT;</span>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=s2>    &quot;&quot;&quot;</span><span class=p>)</span>
</span></code></pre></div> <p><strong>Pros:</strong> Validates before affecting production, atomic transaction <strong>Cons:</strong> More complex, requires extra storage for staging</p> <h4 id=pattern-4-partition-overwrite-best-for-time-series-data>Pattern 4: Partition Overwrite (Best for Time-Series Data)<a class=headerlink href=#pattern-4-partition-overwrite-best-for-time-series-data title="Permanent link">&para;</a></h4> <div class="language-sql highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1>-- BigQuery partitioned table</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>daily_sales_report</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>    </span><span class=nb>date</span><span class=w> </span><span class=nb>DATE</span><span class=p>,</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>    </span><span class=n>product_id</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>    </span><span class=n>revenue</span><span class=w> </span><span class=n>FLOAT64</span><span class=p>,</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>    </span><span class=n>units_sold</span><span class=w> </span><span class=n>INT64</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=p>)</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=nb>date</span><span class=p>;</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=c1>-- Idempotent load: replace only today&#39;s partition</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a><span class=n>MERGE</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>daily_sales_report</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>target</span>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=k>USING</span><span class=w> </span><span class=n>new_sales_data</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>source</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=k>ON</span><span class=w> </span><span class=n>target</span><span class=p>.</span><span class=nb>date</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>source</span><span class=p>.</span><span class=nb>date</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>target</span><span class=p>.</span><span class=n>product_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>source</span><span class=p>.</span><span class=n>product_id</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=k>WHEN</span><span class=w> </span><span class=n>MATCHED</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=k>UPDATE</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=p>...</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class=k>WHEN</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>MATCHED</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=k>INSERT</span><span class=w> </span><span class=p>...;</span>
</span></code></pre></div> <p>For large datasets, BigQuery can atomically replace a single partition:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=c1># Overwrite only the partition for this date</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=n>job_config</span> <span class=o>=</span> <span class=n>bigquery</span><span class=o>.</span><span class=n>QueryJobConfig</span><span class=p>(</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>    <span class=n>write_disposition</span><span class=o>=</span><span class=s1>&#39;WRITE_TRUNCATE&#39;</span><span class=p>,</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>    <span class=n>time_partitioning</span><span class=o>=</span><span class=n>bigquery</span><span class=o>.</span><span class=n>TimePartitioning</span><span class=p>(</span><span class=n>field</span><span class=o>=</span><span class=s1>&#39;date&#39;</span><span class=p>),</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=p>)</span>
</span></code></pre></div> <p><strong>Pros:</strong> Efficient for time-series data, no impact on other dates <strong>Cons:</strong> Requires partitioned tables</p> <h3 id=my-idempotency-checklist>My Idempotency Checklist<a class=headerlink href=#my-idempotency-checklist title="Permanent link">&para;</a></h3> <p>Before deploying any pipeline, I ask:</p> <ol> <li><strong>Can I run this twice safely?</strong> If not, it's not ready.</li> <li><strong>What's my unique key?</strong> (date, transaction_id, user_id + date, etc.)</li> <li><strong>Am I using INSERT or MERGE?</strong> (MERGE is almost always better)</li> <li><strong>What happens if this fails halfway?</strong> (Staging tables save lives)</li> </ol> <h3 id=scars-ive-earned-idempotency-edition>Scars I've Earned: Idempotency Edition<a class=headerlink href=#scars-ive-earned-idempotency-edition title="Permanent link">&para;</a></h3> <p><strong>Scar #1: Used APPEND mode on a retry-enabled pipeline</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=n>df</span><span class=o>.</span><span class=n>to_gbq</span><span class=p>(</span><span class=s1>&#39;dataset.table&#39;</span><span class=p>,</span> <span class=n>if_exists</span><span class=o>=</span><span class=s1>&#39;append&#39;</span><span class=p>)</span>  <span class=c1># With automatic retries</span>
</span></code></pre></div> <strong>What it cost me:</strong> Duplicate data in production, a panicked morning de-duplication session, and executive decisions made on wrong numbers</p> <p><strong>Scar #2: DELETE + INSERT without a transaction</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=n>execute_sql</span><span class=p>(</span><span class=s2>&quot;DELETE FROM sales WHERE date = &#39;2026-01-29&#39;&quot;</span><span class=p>)</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=c1># Pipeline crashes here, data is gone forever</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=n>execute_sql</span><span class=p>(</span><span class=s2>&quot;INSERT INTO sales ...&quot;</span><span class=p>)</span>
</span></code></pre></div> <strong>What it cost me:</strong> Lost data when the insert failed, had to restore from backup, explaining to my manager what a transaction is</p> <p><strong>Scar #3: Unique key wasn't actually unique</strong> <div class="language-sql highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1>-- DON&#39;T</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>events</span><span class=w> </span><span class=p>(</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=w>    </span><span class=n>user_id</span><span class=w> </span><span class=nb>INT</span><span class=p>,</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=w>    </span><span class=n>event_type</span><span class=w> </span><span class=n>STRING</span><span class=p>,</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>    </span><span class=n>created_at</span><span class=w> </span><span class=k>TIMESTAMP</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=p>);</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=c1>-- Thought (user_id, event_type) was unique. It wasn&#39;t.</span>
</span></code></pre></div> <strong>What it cost me:</strong> MERGE statement failed with "duplicate key" error, traced back to bad assumptions about data uniqueness</p> <h2 id=section-4-monitoring-alerting-because-hope-is-not-a-strategy>Section 4: Monitoring &amp; Alerting - Because Hope Is Not A Strategy<a class=headerlink href=#section-4-monitoring-alerting-because-hope-is-not-a-strategy title="Permanent link">&para;</a></h2> <h3 id=the-pipeline-that-failed-for-three-days-before-anyone-noticed>The Pipeline That Failed For Three Days (Before Anyone Noticed)<a class=headerlink href=#the-pipeline-that-failed-for-three-days-before-anyone-noticed title="Permanent link">&para;</a></h3> <p>Let me tell you about the most embarrassing moment of my career.</p> <p>It's Thursday morning. I'm in a planning meeting. My phone buzzes. The product manager: "Hey, our user growth dashboard hasn't updated since Monday. Is something broken?"</p> <p>My stomach drops.</p> <p>I excuse myself, run back to my desk, check Airflow. Sure enough: our user analytics pipeline has been failing since Monday afternoon. Three days. Three. Days.</p> <p>How did nobody notice for three days?</p> <p>Because I didn't set up monitoring.</p> <p>The pipeline ran every night. It updated a user growth dashboard that the product team checked weekly. When it failed, it just... quietly failed. No alerts. No emails. No Slack messages. The scheduler kept trying every night, failing every night, and I had no idea.</p> <p>The failure? A column the vendor added to their data format that broke our transform logic. A simple <code>KeyError</code> that could've been fixed in 5 minutes if I'd known about it on Monday.</p> <p>Instead, I spent Thursday afternoon: 1. Fixing the bug (5 minutes) 2. Backfilling three days of data (45 minutes) 3. Explaining to three different teams why their dashboard was stale (90 minutes) 4. Writing a post-mortem doc (60 minutes) 5. Sitting through a "let's talk about incident response" meeting (30 minutes)</p> <p>That's 3.5 hours of cleanup for a problem that would've taken 5 minutes if I'd noticed it Monday night.</p> <p>My manager's question: "Why didn't we get an alert?"</p> <p>My answer: "Because I didn't set one up."</p> <p>His response: "That changes today."</p> <h3 id=heres-what-i-wish-id-known-monitor-everything-that-matters>Here's What I Wish I'd Known: Monitor Everything That Matters<a class=headerlink href=#heres-what-i-wish-id-known-monitor-everything-that-matters title="Permanent link">&para;</a></h3> <p>Monitoring isn't optional. It's part of the pipeline. Your pipeline isn't "done" until it can tell you when it's broken.</p> <h4 id=level-1-airflow-alerts-the-bare-minimum>Level 1: Airflow Alerts (The Bare Minimum)<a class=headerlink href=#level-1-airflow-alerts-the-bare-minimum title="Permanent link">&para;</a></h4> <p>Built into Airflow:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=n>default_args</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a>    <span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;data-alerts@company.com&#39;</span><span class=p>],</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>    <span class=s1>&#39;email_on_failure&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>  <span class=c1># Send email if task fails</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a>    <span class=s1>&#39;email_on_retry&#39;</span><span class=p>:</span> <span class=kc>False</span><span class=p>,</span>   <span class=c1># Don&#39;t spam on retries</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>    <span class=s1>&#39;retries&#39;</span><span class=p>:</span> <span class=mi>3</span><span class=p>,</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>    <span class=s1>&#39;retry_delay&#39;</span><span class=p>:</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>minutes</span><span class=o>=</span><span class=mi>5</span><span class=p>),</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=p>}</span>
</span></code></pre></div> <p>This catches: - Tasks that fail after retries exhausted - Tasks that timeout - DAGs that don't start on schedule</p> <p>What it doesn't catch: - Data quality issues (wrong schema, missing rows) - Silent failures (task succeeds but produces bad data) - Downstream dependencies breaking</p> <h4 id=level-2-slack-notifications-better>Level 2: Slack Notifications (Better)<a class=headerlink href=#level-2-slack-notifications-better title="Permanent link">&para;</a></h4> <div class="language-python highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow.operators.slack</span><span class=w> </span><span class=kn>import</span> <span class=n>SlackWebhookOperator</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=c1># Task that notifies on failure</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=k>def</span><span class=w> </span><span class=nf>notify_failure</span><span class=p>(</span><span class=n>context</span><span class=p>):</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Called when any task in the DAG fails&quot;&quot;&quot;</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a>    <span class=n>task_instance</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s1>&#39;task_instance&#39;</span><span class=p>]</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a>    <span class=n>exception</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;exception&#39;</span><span class=p>)</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a>    <span class=n>slack_msg</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=s2>    :red_circle: *Pipeline Failed*</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=s2>    • DAG: </span><span class=si>{</span><span class=n>task_instance</span><span class=o>.</span><span class=n>dag_id</span><span class=si>}</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=s2>    • Task: </span><span class=si>{</span><span class=n>task_instance</span><span class=o>.</span><span class=n>task_id</span><span class=si>}</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=s2>    • Execution Date: </span><span class=si>{</span><span class=n>context</span><span class=p>[</span><span class=s1>&#39;ds&#39;</span><span class=p>]</span><span class=si>}</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=s2>    • Error: </span><span class=si>{</span><span class=n>exception</span><span class=si>}</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=s2>    • Logs: </span><span class=si>{</span><span class=n>task_instance</span><span class=o>.</span><span class=n>log_url</span><span class=si>}</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=s2>    &quot;&quot;&quot;</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a>    <span class=n>SlackWebhookOperator</span><span class=p>(</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;slack_alert&#39;</span><span class=p>,</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a>        <span class=n>http_conn_id</span><span class=o>=</span><span class=s1>&#39;slack_webhook&#39;</span><span class=p>,</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a>        <span class=n>message</span><span class=o>=</span><span class=n>slack_msg</span><span class=p>,</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a>        <span class=n>username</span><span class=o>=</span><span class=s1>&#39;Airflow Bot&#39;</span><span class=p>,</span>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a>    <span class=p>)</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>context</span><span class=o>=</span><span class=n>context</span><span class=p>)</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=c1># Add to DAG</span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span><span id=__span-26-27><a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a>    <span class=s1>&#39;critical_pipeline&#39;</span><span class=p>,</span>
</span><span id=__span-26-28><a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a>    <span class=n>default_args</span><span class=o>=</span><span class=n>default_args</span><span class=p>,</span>
</span><span id=__span-26-29><a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a>    <span class=n>on_failure_callback</span><span class=o>=</span><span class=n>notify_failure</span><span class=p>,</span>  <span class=c1># Called if ANY task fails</span>
</span><span id=__span-26-30><a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span><span id=__span-26-31><a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a>    <span class=c1># Your tasks here</span>
</span><span id=__span-26-32><a id=__codelineno-26-32 name=__codelineno-26-32 href=#__codelineno-26-32></a>    <span class=k>pass</span>
</span></code></pre></div> <p>Now failures show up in Slack where your team actually sees them.</p> <h4 id=level-3-data-quality-checks-essential>Level 3: Data Quality Checks (Essential)<a class=headerlink href=#level-3-data-quality-checks-essential title="Permanent link">&para;</a></h4> <p>The pipeline succeeded. But did it produce <em>correct</em> data?</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow.operators.python</span><span class=w> </span><span class=kn>import</span> <span class=n>BranchPythonOperator</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow.operators.dummy</span><span class=w> </span><span class=kn>import</span> <span class=n>DummyOperator</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=kn>from</span><span class=w> </span><span class=nn>airflow.exceptions</span><span class=w> </span><span class=kn>import</span> <span class=n>AirflowException</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=k>def</span><span class=w> </span><span class=nf>validate_sales_data</span><span class=p>(</span><span class=o>**</span><span class=n>context</span><span class=p>):</span>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Check data quality after load&quot;&quot;&quot;</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>    <span class=n>date</span> <span class=o>=</span> <span class=n>context</span><span class=p>[</span><span class=s1>&#39;ds&#39;</span><span class=p>]</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>    <span class=c1># Check 1: Row count isn&#39;t zero</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>    <span class=n>row_count</span> <span class=o>=</span> <span class=n>execute_query</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a><span class=s2>        SELECT COUNT(*) FROM daily_sales_report WHERE date = &#39;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>&#39;</span>
</span><span id=__span-27-12><a id=__codelineno-27-12 name=__codelineno-27-12 href=#__codelineno-27-12></a><span class=s2>    &quot;&quot;&quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-27-13><a id=__codelineno-27-13 name=__codelineno-27-13 href=#__codelineno-27-13></a>
</span><span id=__span-27-14><a id=__codelineno-27-14 name=__codelineno-27-14 href=#__codelineno-27-14></a>    <span class=k>if</span> <span class=n>row_count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-27-15><a id=__codelineno-27-15 name=__codelineno-27-15 href=#__codelineno-27-15></a>        <span class=k>raise</span> <span class=n>AirflowException</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;No data loaded for </span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>!&quot;</span><span class=p>)</span>
</span><span id=__span-27-16><a id=__codelineno-27-16 name=__codelineno-27-16 href=#__codelineno-27-16></a>
</span><span id=__span-27-17><a id=__codelineno-27-17 name=__codelineno-27-17 href=#__codelineno-27-17></a>    <span class=c1># Check 2: Revenue isn&#39;t suspiciously different from yesterday</span>
</span><span id=__span-27-18><a id=__codelineno-27-18 name=__codelineno-27-18 href=#__codelineno-27-18></a>    <span class=n>revenue_change</span> <span class=o>=</span> <span class=n>execute_query</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-27-19><a id=__codelineno-27-19 name=__codelineno-27-19 href=#__codelineno-27-19></a><span class=s2>        SELECT</span>
</span><span id=__span-27-20><a id=__codelineno-27-20 name=__codelineno-27-20 href=#__codelineno-27-20></a><span class=s2>            (SELECT SUM(revenue) FROM daily_sales_report WHERE date = &#39;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>&#39;) /</span>
</span><span id=__span-27-21><a id=__codelineno-27-21 name=__codelineno-27-21 href=#__codelineno-27-21></a><span class=s2>            (SELECT SUM(revenue) FROM daily_sales_report WHERE date = DATE_SUB(&#39;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>&#39;, INTERVAL 1 DAY))</span>
</span><span id=__span-27-22><a id=__codelineno-27-22 name=__codelineno-27-22 href=#__codelineno-27-22></a><span class=s2>            AS revenue_ratio</span>
</span><span id=__span-27-23><a id=__codelineno-27-23 name=__codelineno-27-23 href=#__codelineno-27-23></a><span class=s2>    &quot;&quot;&quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-27-24><a id=__codelineno-27-24 name=__codelineno-27-24 href=#__codelineno-27-24></a>
</span><span id=__span-27-25><a id=__codelineno-27-25 name=__codelineno-27-25 href=#__codelineno-27-25></a>    <span class=k>if</span> <span class=n>revenue_change</span> <span class=o>&gt;</span> <span class=mf>2.0</span> <span class=ow>or</span> <span class=n>revenue_change</span> <span class=o>&lt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span><span id=__span-27-26><a id=__codelineno-27-26 name=__codelineno-27-26 href=#__codelineno-27-26></a>        <span class=c1># Revenue doubled or halved? Probably a data issue</span>
</span><span id=__span-27-27><a id=__codelineno-27-27 name=__codelineno-27-27 href=#__codelineno-27-27></a>        <span class=k>raise</span> <span class=n>AirflowException</span><span class=p>(</span>
</span><span id=__span-27-28><a id=__codelineno-27-28 name=__codelineno-27-28 href=#__codelineno-27-28></a>            <span class=sa>f</span><span class=s2>&quot;Revenue changed by </span><span class=si>{</span><span class=n>revenue_change</span><span class=si>:</span><span class=s2>.1%</span><span class=si>}</span><span class=s2> from yesterday. &quot;</span>
</span><span id=__span-27-29><a id=__codelineno-27-29 name=__codelineno-27-29 href=#__codelineno-27-29></a>            <span class=sa>f</span><span class=s2>&quot;Investigate before proceeding.&quot;</span>
</span><span id=__span-27-30><a id=__codelineno-27-30 name=__codelineno-27-30 href=#__codelineno-27-30></a>        <span class=p>)</span>
</span><span id=__span-27-31><a id=__codelineno-27-31 name=__codelineno-27-31 href=#__codelineno-27-31></a>
</span><span id=__span-27-32><a id=__codelineno-27-32 name=__codelineno-27-32 href=#__codelineno-27-32></a>    <span class=c1># Check 3: No null values in critical columns</span>
</span><span id=__span-27-33><a id=__codelineno-27-33 name=__codelineno-27-33 href=#__codelineno-27-33></a>    <span class=n>null_check</span> <span class=o>=</span> <span class=n>execute_query</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
</span><span id=__span-27-34><a id=__codelineno-27-34 name=__codelineno-27-34 href=#__codelineno-27-34></a><span class=s2>        SELECT COUNT(*) FROM daily_sales_report</span>
</span><span id=__span-27-35><a id=__codelineno-27-35 name=__codelineno-27-35 href=#__codelineno-27-35></a><span class=s2>        WHERE date = &#39;</span><span class=si>{</span><span class=n>date</span><span class=si>}</span><span class=s2>&#39; AND (product_id IS NULL OR revenue IS NULL)</span>
</span><span id=__span-27-36><a id=__codelineno-27-36 name=__codelineno-27-36 href=#__codelineno-27-36></a><span class=s2>    &quot;&quot;&quot;</span><span class=p>)[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-27-37><a id=__codelineno-27-37 name=__codelineno-27-37 href=#__codelineno-27-37></a>
</span><span id=__span-27-38><a id=__codelineno-27-38 name=__codelineno-27-38 href=#__codelineno-27-38></a>    <span class=k>if</span> <span class=n>null_check</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span><span id=__span-27-39><a id=__codelineno-27-39 name=__codelineno-27-39 href=#__codelineno-27-39></a>        <span class=k>raise</span> <span class=n>AirflowException</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Found </span><span class=si>{</span><span class=n>null_check</span><span class=si>}</span><span class=s2> rows with null values!&quot;</span><span class=p>)</span>
</span><span id=__span-27-40><a id=__codelineno-27-40 name=__codelineno-27-40 href=#__codelineno-27-40></a>
</span><span id=__span-27-41><a id=__codelineno-27-41 name=__codelineno-27-41 href=#__codelineno-27-41></a>    <span class=c1># All checks passed</span>
</span><span id=__span-27-42><a id=__codelineno-27-42 name=__codelineno-27-42 href=#__codelineno-27-42></a>    <span class=k>return</span> <span class=s1>&#39;send_success_notification&#39;</span>
</span><span id=__span-27-43><a id=__codelineno-27-43 name=__codelineno-27-43 href=#__codelineno-27-43></a>
</span><span id=__span-27-44><a id=__codelineno-27-44 name=__codelineno-27-44 href=#__codelineno-27-44></a><span class=c1># In your DAG</span>
</span><span id=__span-27-45><a id=__codelineno-27-45 name=__codelineno-27-45 href=#__codelineno-27-45></a><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span><span class=s1>&#39;sales_pipeline&#39;</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span><span id=__span-27-46><a id=__codelineno-27-46 name=__codelineno-27-46 href=#__codelineno-27-46></a>    <span class=n>load</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;load_sales_data&#39;</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span>
</span><span id=__span-27-47><a id=__codelineno-27-47 name=__codelineno-27-47 href=#__codelineno-27-47></a>
</span><span id=__span-27-48><a id=__codelineno-27-48 name=__codelineno-27-48 href=#__codelineno-27-48></a>    <span class=n>validate</span> <span class=o>=</span> <span class=n>BranchPythonOperator</span><span class=p>(</span>
</span><span id=__span-27-49><a id=__codelineno-27-49 name=__codelineno-27-49 href=#__codelineno-27-49></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;validate_data&#39;</span><span class=p>,</span>
</span><span id=__span-27-50><a id=__codelineno-27-50 name=__codelineno-27-50 href=#__codelineno-27-50></a>        <span class=n>python_callable</span><span class=o>=</span><span class=n>validate_sales_data</span><span class=p>,</span>
</span><span id=__span-27-51><a id=__codelineno-27-51 name=__codelineno-27-51 href=#__codelineno-27-51></a>        <span class=n>provide_context</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-27-52><a id=__codelineno-27-52 name=__codelineno-27-52 href=#__codelineno-27-52></a>    <span class=p>)</span>
</span><span id=__span-27-53><a id=__codelineno-27-53 name=__codelineno-27-53 href=#__codelineno-27-53></a>
</span><span id=__span-27-54><a id=__codelineno-27-54 name=__codelineno-27-54 href=#__codelineno-27-54></a>    <span class=n>success</span> <span class=o>=</span> <span class=n>SlackWebhookOperator</span><span class=p>(</span>
</span><span id=__span-27-55><a id=__codelineno-27-55 name=__codelineno-27-55 href=#__codelineno-27-55></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;send_success_notification&#39;</span><span class=p>,</span>
</span><span id=__span-27-56><a id=__codelineno-27-56 name=__codelineno-27-56 href=#__codelineno-27-56></a>        <span class=n>message</span><span class=o>=</span><span class=s1>&#39;✅ Sales pipeline completed and validated&#39;</span><span class=p>,</span>
</span><span id=__span-27-57><a id=__codelineno-27-57 name=__codelineno-27-57 href=#__codelineno-27-57></a>    <span class=p>)</span>
</span><span id=__span-27-58><a id=__codelineno-27-58 name=__codelineno-27-58 href=#__codelineno-27-58></a>
</span><span id=__span-27-59><a id=__codelineno-27-59 name=__codelineno-27-59 href=#__codelineno-27-59></a>    <span class=c1># Only send success notification if validation passes</span>
</span><span id=__span-27-60><a id=__codelineno-27-60 name=__codelineno-27-60 href=#__codelineno-27-60></a>    <span class=n>load</span> <span class=o>&gt;&gt;</span> <span class=n>validate</span> <span class=o>&gt;&gt;</span> <span class=n>success</span>
</span></code></pre></div> <p>This catches: - Empty loads (source file missing) - Schema changes (unexpected nulls) - Data anomalies (revenue suddenly doubled)</p> <h4 id=level-4-slas-service-level-agreements>Level 4: SLAs (Service Level Agreements)<a class=headerlink href=#level-4-slas-service-level-agreements title="Permanent link">&para;</a></h4> <p>Define acceptable latency:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>    <span class=s1>&#39;sales_pipeline&#39;</span><span class=p>,</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>    <span class=n>default_args</span><span class=o>=</span><span class=n>default_args</span><span class=p>,</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a>    <span class=n>sla_miss_callback</span><span class=o>=</span><span class=n>notify_sla_miss</span><span class=p>,</span>  <span class=c1># Called if SLA is breached</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a>    <span class=n>load</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;load_sales&#39;</span><span class=p>,</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>        <span class=n>python_callable</span><span class=o>=</span><span class=n>load_sales_data</span><span class=p>,</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a>        <span class=n>sla</span><span class=o>=</span><span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>  <span class=c1># Must complete within 1 hour</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>    <span class=p>)</span>
</span></code></pre></div> <p>If the task takes longer than 1 hour, you get notified even if it eventually succeeds.</p> <h4 id=level-5-external-monitoring-paranoid-but-good>Level 5: External Monitoring (Paranoid, But Good)<a class=headerlink href=#level-5-external-monitoring-paranoid-but-good title="Permanent link">&para;</a></h4> <p>Use an external service (Datadog, PagerDuty, Dead Man's Snitch) to verify pipelines ran:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=kn>import</span><span class=w> </span><span class=nn>requests</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=k>def</span><span class=w> </span><span class=nf>heartbeat_ping</span><span class=p>(</span><span class=o>**</span><span class=n>context</span><span class=p>):</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Ping external monitor to prove pipeline ran&quot;&quot;&quot;</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a>    <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://deadmanssnitch.com/your-unique-url&#39;</span><span class=p>)</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=c1># Last task in DAG</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span><span class=s1>&#39;critical_pipeline&#39;</span><span class=p>,</span> <span class=o>...</span><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a>    <span class=c1># ... all your tasks ...</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a>    <span class=n>heartbeat</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a>        <span class=n>task_id</span><span class=o>=</span><span class=s1>&#39;heartbeat&#39;</span><span class=p>,</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a>        <span class=n>python_callable</span><span class=o>=</span><span class=n>heartbeat_ping</span><span class=p>,</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a>    <span class=p>)</span>
</span><span id=__span-29-15><a id=__codelineno-29-15 name=__codelineno-29-15 href=#__codelineno-29-15></a>
</span><span id=__span-29-16><a id=__codelineno-29-16 name=__codelineno-29-16 href=#__codelineno-29-16></a>    <span class=c1># Final task</span>
</span><span id=__span-29-17><a id=__codelineno-29-17 name=__codelineno-29-17 href=#__codelineno-29-17></a>    <span class=n>final_task</span> <span class=o>&gt;&gt;</span> <span class=n>heartbeat</span>
</span></code></pre></div> <p>If the pipeline doesn't run at all (Airflow crashes, server reboots, etc.), the external service doesn't receive the heartbeat and alerts you.</p> <h3 id=my-monitoring-pyramid>My Monitoring Pyramid<a class=headerlink href=#my-monitoring-pyramid title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>                        [External Heartbeat]          ← Most reliable
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>                    [SLAs &amp; Latency Monitoring]
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>                [Data Quality Validation]
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a>            [Slack Notifications]
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a>        [Email Alerts]
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a>    [Airflow Logs]
</span></code></pre></div> <p>Start at the bottom, work your way up.</p> <h3 id=scars-ive-earned-monitoring-edition>Scars I've Earned: Monitoring Edition<a class=headerlink href=#scars-ive-earned-monitoring-edition title="Permanent link">&para;</a></h3> <p><strong>Scar #1: Only monitored pipeline failures, not data quality</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=c1># Pipeline succeeds but loads zero rows</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=n>load_data</span><span class=p>()</span>  <span class=c1># Success!</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=c1># Nobody notices for three days</span>
</span></code></pre></div> <strong>What it cost me:</strong> Three days of stale dashboards, product decisions made on old data, and a very awkward meeting</p> <p><strong>Scar #2: Alert fatigue from over-monitoring</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=s1>&#39;email_on_retry&#39;</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>  <span class=c1># Spams you on every retry</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=s1>&#39;retries&#39;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=c1># You wake up to 10 emails at 3 AM</span>
</span></code></pre></div> <strong>What it cost me:</strong> Started ignoring emails, then missed a real alert in the noise, causing a different 3-day outage</p> <p><strong>Scar #3: No escalation for critical pipelines</strong> <div class="language-python highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># DON&#39;T</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=s1>&#39;email&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;me@company.com&#39;</span><span class=p>],</span>  <span class=c1># Only alerts me</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=c1># I&#39;m on vacation, pipeline breaks, nobody else knows</span>
</span></code></pre></div> <strong>What it cost me:</strong> CFO asked about dashboard data while I was on a beach in Tel Aviv, team couldn't fix it without me, I spent vacation debugging remotely</p> <h2 id=summary>Summary<a class=headerlink href=#summary title="Permanent link">&para;</a></h2> <p>Building reliable data pipelines is about more than just transformations:</p> <ul> <li><strong>ETL vs ELT:</strong> Transform where it makes sense—in Python/Spark for complex logic, in SQL for structured data</li> <li><strong>Apache Airflow:</strong> Orchestration beats cron every time—retries, monitoring, and dependency management built-in</li> <li><strong>Idempotency:</strong> Design pipelines to run safely multiple times—use MERGE/UPSERT, staging tables, and partitions</li> <li><strong>Monitoring:</strong> Hope is not a strategy—alert on failures, validate data quality, and set up heartbeats</li> </ul> <p>The difference between a data engineer and a senior data engineer? The senior engineer designs for failure from day one.</p> <h2 id=reflection-questions>Reflection Questions<a class=headerlink href=#reflection-questions title="Permanent link">&para;</a></h2> <ol> <li> <p>When was the last time you re-ran a pipeline and weren't 100% sure it wouldn't create duplicates? How would you fix that?</p> </li> <li> <p>If your most critical pipeline failed right now, how long would it take for someone to notice? Who would notice first—you or your users?</p> </li> <li> <p>Think about a pipeline you've built. If it silently started loading zero rows every day, what would break? When would you find out?</p> </li> </ol> <h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <p>In the next chapter, we'll dive deeper into data quality and error handling. We'll explore: - Great Expectations for systematic data validation - Circuit breakers for cascading failures - Dead letter queues for unprocessable records - Observability patterns that give you confidence your pipelines are healthy</p> <p>Because pipelines that run are good. Pipelines that run <em>correctly</em> are better.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2026 Data Engineering Bootcamp </div> </div> <div class=md-social> <a href=https://github.com/yourusername/data-engineering-course target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://linkedin.com/in/yourprofile target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../../javascripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>